




/*
     FILE ARCHIVED ON 0:34:18 Jan 9, 2013 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 16:25:24 Aug 11, 2016.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
window.surroundingAreasMapping=new function(){var t=this,k="",u="",r={},f={},o={},y={City:0,Neighborhood:1,Zipcode:2},a={TYPE_CITY:0,TYPE_NEIGHBORHOOD:1,TYPE_ZIPCODE:2},z={},j="",c=113,x=[],v=function(){var J=$("#selectedCities").val(),L=$("#selectedNeighborhoods").val(),I=$("#selectedZipcodes").val(),K="",H;K=B(K,J);K=B(K,L);K=B(K,I);if(K==""){H=[]}else{H=K.split(",")}x=H;$.each(x,function(M,O){var N=f[O];d(N.lid)})},s=function(){var H=$("#surroundingAreaSearchType").val()||"City";return H},G=function(H){return $("#surroundingArea_"+H)},n=function(H){return H.parent().parent().parent()},i=function(H){return n(G(H))},l=function(H){return H.parents(".searchType")},b=function(H){$("#panelToggleControl, #fullListToggleControl").toggle(H)},D=function(){t.updateCurrentAreaSelections();$("#SurroundingAreasModalDiv").show();b(false);var L=$("#surroundingAreasToolTip"),H=L.find("input:radio"),J=L.find("input:checkbox"),I=$();H.uniform();J.uniform();L.show();$.uniform.update();H.each(function(){var N=$(this),M=l(N);M.toggleClass("selected",N.attr("checked"));I.add(M);N.click(function(){if(!N.attr("checked")){return}I.removeClass("selected");M.addClass("selected");$("#surroundingAreaSearchType").val(N.val());$("#switchAreaSearchType").val("Y");Track.doEvent("Surrounding Areas","Select Search Type",N.val());t.loadSurroundingAreasModal()})});var K=window.g_pageLiquidLayout.getMap();J.click(function(){var N=$(this),P=N.attr("checked"),M=N.val(),O=n(N).find(".checkLabel").html();if(P){t.gaTrackAddArea(O);d(M)}else{t.gaTrackRemoveArea(O);h(M)}N.parent().parent().parent().toggleClass("selected",P);K.setSurroundingAreaChecked(M,P)});$(".surroundingCheckLabel").hover(function(){var N=$(this);if(N.hasClass("selected")){return}N.addClass("hover");var M=N.find("input:checkbox").val();K.setSurroundingAreaHover(M,true)},function(){var N=$(this);N.removeClass("hover");var M=N.find("input:checkbox").val();K.setSurroundingAreaHover(M,false)});E();q();K.renderSurroundingAreas();e()},E=function(){var I=$("#myPlacesSection"),H=window.g_pageLiquidLayout.getMap();I.hover(function(){I.addClass("hover")},function(){I.removeClass("hover")});I.find(".myplaceLink, .myplaceIcon").click(function(){if(I.hasClass("selected")){Track.doEvent("Surrounding Areas","Turn off My Places");m();H.disableMyC21Places()}else{Track.doEvent("Surrounding Areas","Turn on My Places");F();H.enableMyC21Places();$("#myPlacesToolInstructions").removeClass("active")}});if(H.isMyPlacesEnabled()){F()}else{m()}},A=function(){if((g_MyPlaces==null)||(g_MyPlaces!=null&&g_MyPlaces.length==0)){C21.Places.loadMyPlacesModal()}},F=function(){var I=$("#myPlacesSection");var H=$(".myplaceLink");H.text("Turn off My Places");I.addClass("selected")},m=function(){var I=$("#myPlacesSection");var H=$(".myplaceLink");H.text("Turn on My Places");I.removeClass("selected")},q=function(){var K=$("#surroundingAreasToolTip"),I=K.find("input:checkbox"),H=t.getSelectionsBox(),J=H.val();I.each(function(){var M=$(this),L=M.parent().parent().parent();if(J&&C(J.split(","),M.val())){L.addClass("selected");M.attr("checked",true)}else{L.removeClass("selected");M.attr("checked",false)}});$.uniform.update()},g=function(I,H){var J=I.val();if(J){if(J.indexOf(H+",")!=-1){J=J.replace(H+",","")}else{if(J.indexOf(","+H)!=-1){J=J.replace(","+H,"")}else{J=J.replace(H,"")}}}I.val(J)},C=function(H,J){var I=H.length;while(I--){if(H[I]===J){return true}}return false},p=function(I){$("#SurroundingAreasModalDiv").hide();b(true);var H=t.getSelectedSurroundingAreas();portalResults.changeSurroundingAreas(0,H,I);if(H.length!=0){Track.doEvent("Surrounding Areas","Added areas to search",H.length)}},B=function(H,I){if(H==""){H=I}else{if(I!=""){H=H+","+I}}return H},e=function(){var H=c+parseInt($(".currentSrBox").css("height"))-parseInt($(".currentSrBox").css("min-height"));$("#surroundingAreasToolTip .contentTip").animate({top:H})},d=function(I){if(o[I]){return}var K=f[I],H=t.getSelectionsBox(I),J=H.val();r[K.location]=K;o[I]=K;if(J==null||J==""){J=I}else{J=J+","+I}H.val(J)},h=function(I){if(!o[I]){return}var K=f[I],H=t.getSelectionsBox(I),J=H.val();delete r[K.location];delete o[I];if(J){if(J.indexOf(I+",")!=-1){J=J.replace(I+",","")}else{if(J.indexOf(","+I)!=-1){J=J.replace(","+I,"")}else{J=J.replace(I,"")}}}H.val(J)},w=function(){var O=$("#fullListToggleControl"),M=$(".LiquidBodyMiddle"),L=$(".LiquidBodyMain"),K=$("#listContainer"),I=M.width(),N=L.width(),H=L.position(),J=$("#surroundingAreasLiqMap");J.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});J.click(function(){if(J.hasClass("selected")){Track.doEvent("Surrounding Areas","Close Surrounding Areas Tool");$(".mapToolsArea").show();$("#typeContainer").show();$(".OverlaysTL").show();$("#BodyRightLane").show();$("#mapContainer").css("top","31px");if($("#bottomMapTools").hasClass("selected")){$("#bottomMapToolsDropDown").show()}var P=t.getSelectedSurroundingAreas().join(),S=x.join(),Q=true;if(P==S&&k!=""&&u!=""){window.g_pageLiquidLayout.getMap().setMapView(k,u);Q=false}$("#searchLocationLIDS").val(P);var R=window.g_pageLiquidLayout.getMap();R.clearSurroundingAreas();R.refreshHeatmap();R.refreshPOI();window.g_pageLiquidLayout.openCenterLane();J.removeClass("selected");p(Q)}else{window.g_pageLiquidLayout.onReady(function(){k=window.g_pageLiquidLayout.getMap().getZoom();u=window.g_pageLiquidLayout.getMap().getBounds();Track.doEvent("Surrounding Areas","Open Surrounding Areas Tool");J.addClass("selected");$(".mapToolsArea").hide();$("#typeContainer").hide();$(".OverlaysTL").hide();$("#BodyRightLane").hide();$("#mapContainer").css("top","0px");$("#bottomMapToolsDropDown").hide();var T=window.g_pageLiquidLayout.getMap();T.clearAll();T.clearTooltips();T.clearHeatMap();T.clearPOI();T.clearSchools();$("#myPlacesToolInstructions").removeClass("active");$("#myPlacesTool").removeClass("selected");schoolSearch.closeWindow();$("#switchAreaSearchType").val("");window.g_pageLiquidLayout.closeCenterLane(function(){t.loadSurroundingAreasModal()},true)})}})};this.initialize=function(){w()};this.clearSurroundingAreas=function(){r={};o={};$("#selectedCities").val("");$("#selectedNeighborhoods").val("");$("#selectedZipcodes").val("")};this.expandTooltipPosition=function(H){var I=parseInt($("#surroundingAreasToolTip .contentTip").css("top"))+H;$("#surroundingAreasToolTip .contentTip").animate({top:I})};this.collapseTooltipPosition=function(I){var H=c+I;$("#surroundingAreasToolTip .contentTip").animate({top:H})};this.addData=function(H){z=H.locations;$.extend(z,r);f={};$.each(z,function(I,J){f[J.lid]=J})};this.addPrimaryData=function(H){$.each(H.locations,function(I,J){j=I;t.updateArea(I,J)})};this.updateArea=function(H,I){if(z[H]){$.extend(z[H],I)}else{z[H]=I}};this.addSearchCountsData=function(H){$.each(H.locations,function(I,J){t.updateArea(I,J)})};this.getSurroundingAreas=function(){return z};this.getPrimaryArea=function(){return z[j]};this.getPrimaryAreaLocation=function(){return j};this.getSurroundingArea=function(H){return z[H]};this.closeWindow=function(){if($("#surroundingAreasLiqMap").hasClass("selected")){$("#surroundingAreasLiqMap").trigger("click")}};this.isAreaSelected=function(H){return(o[H]!==undefined)};this.toggleSelectedSurroundingArea=function(J){var I=G(J),K=n(I),M=t.isAreaSelected(J),L=f[J],H=L.dislayName;if(M){t.gaTrackRemoveArea(H);h(J);M=false}else{t.gaTrackAddArea(H);d(J);M=true}if(I.length>0){I.attr("checked",M);K.toggleClass("selected",M);$.uniform.update()}return M};this.addHoverSurroundingAreaCheckbox=function(H){i(H).addClass("hover");$("#uniform-surroundingArea_"+H).addClass("hover");$.uniform.update()};this.removeHoverSurroundingAreaCheckbox=function(H){i(H).removeClass("hover");$("#uniform-surroundingArea_"+H).removeClass("hover");$.uniform.update()};this.gaTrackAddArea=function(J){var I=s(),H=$("#refineText").val();if(H!=null&&H!=""&&J!=null&&J!=""){Track.doEvent("Surrounding Areas","Add "+I,H+" added "+J)}};this.gaTrackRemoveArea=function(J){var I=s(),H=$("#refineText").val();if(H!=null&&H!=""&&J!=null&&J!=""){Track.doEvent("Surrounding Areas","Remove "+I,H+" removed "+J)}};this.getSelectedSurroundingAreas=function(){var H=[];$.each(o,function(I,J){H.push(I)});return H};this.loadSurroundingAreasModal=function(){var L=portalAjax.getParameters(),K=s(),M=$("#selectedCities").val()||"",J=$("#selectedNeighborhoods").val()||"",I=$("#selectedZipcodes").val()||"",H=$("#switchAreaSearchType").val()||"";$("#searchListCheckBoxes").addClass("loadingAreas").empty();portalAjax.doViewEngineAjax("flyout","/surroundingAreas.c21",$.param({lid:L.lid,zoom:18,surroundingsearchtype:K,selectedCities:M,selectedNeighborhoods:J,selectedZipcodes:I,switchAreaSearchType:H,submitted:true,v:3}),{cache:true,callback:function(){D();$("#searchListCheckBoxes").removeClass("loadingAreas");v()}})};this.removeAreaFromAllSearchTypes=function(H){if(H!=null&&H!=""){var I=o[H];delete r[I.location];delete o[H];g($("#selectedCities"),H);g($("#selectedNeighborhoods"),H);g($("#selectedZipcodes"),H)}};this.getCurrentSearchLidType=function(){var H=s();return y[H]};this.getSelectionsBox=function(H){var I=(H)?t.getLidType(H):t.getCurrentSearchLidType();switch(I){case a.TYPE_CITY:return $("#selectedCities");break;case a.TYPE_NEIGHBORHOOD:return $("#selectedNeighborhoods");break;case a.TYPE_ZIPCODE:return $("#selectedZipcodes");break;default:return null}};this.getLidType=function(I){var H=I.substring(0,1);switch(H){case"C":return a.TYPE_CITY;break;case"Z":return a.TYPE_ZIPCODE;break;case"P":case"Q":case"R":return a.TYPE_NEIGHBORHOOD;break;default:return null}};this.updateCurrentAreaSelections=function(){if($("#switchAreaSearchType").val()=="Y"){return}var J=portalAjax.getParameters(),H=J.sa;t.clearSurroundingAreas();if(H==null||H==""||H=="undefined"){return}else{var I=H.split(",");$.each(I,function(K,L){if(L!=null&&L!=""){d(L)}})}}};