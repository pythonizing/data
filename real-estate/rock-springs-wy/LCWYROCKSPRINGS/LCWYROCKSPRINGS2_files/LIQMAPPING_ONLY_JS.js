




/*
     FILE ARCHIVED ON 0:34:17 Jan 9, 2013 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 16:25:25 Aug 11, 2016.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
$("head").append("<style>.VE_Pushpin_Popup{position: absolute; z-index: 1000; display: none;}</style>");Microsoft.Maps.Map.prototype.AddInfobox=function(b,d){d._infobox=$('<div class="VE_Pushpin_Popup"></div>');var c=new Microsoft.Maps.Pushpin(b,d);this.entities._tryLocationToPixel=this.tryLocationToPixel;this.entities.push(c);if(!this.customInfoboxEntities){this.customInfoboxEntities=[]}this.customInfoboxEntities.push(c);var a=$(this.getRootElement());a.append(c._infobox);this._entityAdded({entity:c,collection:this.entities});return c};Microsoft.Maps.Map.prototype.ClearInfoboxes=function(){var a=this;if(this.customInfoboxEntities){$.each(this.customInfoboxEntities,function(c,b){b._infobox.remove();a.entities.remove(b)});a.customInfoboxEntities=[]}};Microsoft.Maps.Pushpin.prototype.ShowInfoBox=function(){var c=this,h=c.tryLocationToPixel(c._location,Microsoft.Maps.PixelReference.control);if(h){var b=Math.floor(h.x),g=Math.floor(h.y),a=Math.floor(c._infobox.height()/2),f=Math.floor(c._infobox.width()/2),e=b-f,d=g-a;if($.browser.msie&&parseInt($.browser.version,10)===7){}c._infobox.css({position:"absolute",left:e,top:d}).show()}else{this._infobox.hide()}this._infoboxShown=true};Microsoft.Maps.Pushpin.prototype._infoboxShown=false;Microsoft.Maps.Pushpin.prototype._infoboxToggle=function(a){a.target.ToggleInfoBox()};Microsoft.Maps.Pushpin.prototype._infoboxShow=function(a){a.target.ShowInfoBox()};Microsoft.Maps.Map.prototype._entityAdded=function(b){var a=b.entity;if(a._infobox){a.tryLocationToPixel=b.collection._tryLocationToPixel}};Microsoft.Maps.Map.prototype._entityRemoved=function(b){var a=b.target;if(a._infobox){a.tryLocationToPixel=null;a._infobox.remove()}};Microsoft.Maps.Pushpin.prototype._setOptions=Microsoft.Maps.Pushpin.prototype.setOptions;Microsoft.Maps.Pushpin.prototype.setOptions=function(a){this._setOptions(a);if(a.sticky){this.sticky=a.sticky}if(a.title){this.title=a.title}if(a.description){this.description=a.description}if(a._infobox){this._infobox=a._infobox}if(!a.infobox){a.infobox=$('<div class="Title">'+this.title+'</div><div class="Description">'+this.description+"</div>")}else{if(a.infobox&&this.infobox&&(a.infobox!=this.infobox)){this._infobox.remove(this.infobox)}}this.infobox=a.infobox;if(this._infobox){this._infobox.append(this.infobox)}};window.Ve7Infobox=function(a){Microsoft.Maps.Events.addHandler(a.entities,"entityAdded",a._entityAdded);Microsoft.Maps.Events.addHandler(a.entities,"entityRemoved",a._entityRemoved);Microsoft.Maps.Events.addHandler(a,"viewchange",function(){var e=this.target.customInfoboxEntities;if(!e){return}var b=e.length;for(var d=0;d<b;d++){var c=e[d];c.ShowInfoBox()}})};(function(){var e=window.jQuery,d=window.Microsoft.Maps,c=window.Century21=window.Century21||{},b=c.Maps={},a=function(){c.Track=window.Track;c.Places=window.myc21Places;c.portalAjax=window.portalAjax;c.portalResults=window.portalResults;c.PortalParams=window.PortalParams;c.Helpers=window.c21Helpers;c.SchoolSearch=window.schoolSearch;c.ImageLazyLoader=window.ImageLazyLoader;c.ViewSession=window.ViewSession;c.Collapsasaurus=window.Collapsasaurus;c.SurroundingAreasMapping=window.surroundingAreasMapping;c.SurroundingAreasMappingDefault=window.surroundingAreasMappingDefault};a();e(document).ready(a);b.bingmapCredentials="AlsCLECtdXqwb_3W2IonsqKIGxx-DNAxfQHpLde0s2JThSsYLBIsRuWXjSL_fI8P";c.Setup={mapModule:function(f){f(e,c,b,d)}}}());window.Century21.Setup.mapModule(function(d,b,a,c){a.POIMapLayer=function(k,j){var g=this,l=new c.EntityCollection({zIndex:3}),i=0,h=k,f=j,e=function(){h.entities.push(l)};e();g.addPushPin=function(n,p,o){i++;var m=new c.Pushpin(n,{typeName:"IconPoi"+p+"16 uniquePOI_"+i,height:16,width:16,anchor:new c.Point(8,8),icon:"/images/clear.gif"});l.push(m);d(".uniquePOI_"+i).attr("title",o);a.onPinHoverIntent(h,m,function(){b.Track.doEvent("Hybrid Mapping","Points of Interest Map","Hover over a point of interest on the map")},function(){});c.Events.addHandler(m,"click",function(q){b.Track.doEvent("Hybrid Mapping","Points of Interest Map","Click on a point of interest on the map")})};g.clearPOI=function(){l.clear()};g.render=function(o){if(o&&o.length>0){var n=h.getBounds(),m={xy:n.getNorth().toString(),mx:n.getWest().toString(),my:n.getSouth().toString(),xx:n.getEast().toString(),submitted:"true",ct:o,subView:"PointsOfInterestSearch"};d.ajax({dataType:"json",data:m,url:"/pointsofinterest.c21?",success:function(q){var p=q.locations;g.clearPOI();if(p.length>999){f.enable("poi");return}f.disable("poi");d.each(p,function(t,s){var u=new c.Location(s.latitude,s.longitude),r=s.type.toLowerCase().replace(/((^| )[a-z])/g,function(v){return d.trim(v.toUpperCase())}).split(" ")[0];g.addPushPin(u,r,s.name.replace("&amp;","&")+(s.phone?"   Phone: "+s.phone:""))})}})}else{g.clearPOI()}}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.MyPlacesMapLayer=function(h,f,j){var n=this,e=new c.EntityCollection({zIndex:1}),i=new c.EntityCollection({zIndex:5}),k=0,l=f,m=h,g=function(){l.entities.push(e);l.entities.push(i)};g();n.addPushPin=function(r,q,p,v,t,s){k++;var o=new c.Pushpin(p,{typeName:"IconMapPin savedPlaceColor IconPin IconPinLabel"+s+" IconPin"+v+" uniquePlace_"+k,text:" ",height:30,width:28,textOffset:new c.Point(0,0),anchor:new c.Point(9,27),offset:new c.Point(0,0),icon:"/images/clear.gif"});var u=new a.PinData(q,p.latitude,p.longitude,{card:d("#myPlaceMapHoverOverlay"),colorIndex:v});i.push(o);c.Events.addHandler(o,"click",function(w){b.Track.doEvent("Hybrid Mapping","My Places Map","Click on a place on the map");b.Places.loadMyPlacesModal(q)});a.onPinHoverIntent(l,o,function(){b.Track.doEvent("Hybrid Mapping","My Places Map","Hover over a place on the map");d("#myPlaceMapHoverOverlay .myPlaceName").text(r.addresstext);d("#myPlaceMapHoverOverlay .myPlaceAddress").text(r.addressname);if(r.surroundingradius>0){d("#myPlaceMapHoverOverlay .myPlaceRadius").text("Showing Radius of "+r.surroundingradius+" mi.")}else{d("#myPlaceMapHoverOverlay .myPlaceRadius").text("Showing No Radius")}j.showHoverTooltip(u)},function(){j.hideHoverTooltip()});a.onMapClick(l,function(w){j.clear()})};n.drawCircle=function(p,o,s){var q=["#f26c4f","#6dcff6","#c1d72e","#f7941d","#fff568","#bd8cbf","#f06eaa","#ffffff","#8393ca","#3cb878","#fdc689"],r=["#f26c4f","#6dcff6","#c1d72e","#f7941d","#fff568","#bd8cbf","#f06eaa","#cccccc","#8393ca","#3cb878","#fdc689"],t=m.getCircle(p,o*1.609344,750,r[s-1],1,0.7,q[s-1],0.5);e.push(t)};n.clearMyPlaces=function(){i.clear();e.clear();k=0};n.render=function(){n.clearMyPlaces();var p=b.Places.getPlaces();var o=0;d.each(p,function(r,q){if(q.latitude==null||q.latitude==""||q.latitude==0||q.longitude==null||q.longitude==""||q.longitude==0){window["myPlaceGeocodeCallback"+o]=function(s){if(s&&s.resourceSets&&s.resourceSets.length>0&&s.resourceSets[0].resources&&s.resourceSets[0].resources.length>0){var t=s.resourceSets[0].resources[0].point.coordinates;b.portalAjax.doViewEngineAjax("savemyplacegeocodes","/myc21.c21",d.param({itemid:q.item_id,latitude:t[0],longitude:t[1]}),{cache:false});if(q.active=="Y"){n.addPlaceToMap(q,t[0],t[1],r+1)}}};n.geocodeAddressAndSaveCoords(q,o);o++}else{if(q.active=="Y"){n.addPlaceToMap(q,q.latitude,q.longitude,r+1)}}})};n.addPlaceToMap=function(q,s,u,r){var t=new c.Location(s,u);var p=q.addresstext+" | "+q.addressname;var o=q.pincolor;n.addPushPin(q,q.item_id,t,o,p,r);n.drawCircle(t,q.surroundingradius,q.pincolor)};n.callGeocodeRESTService=function(q){var p=document.createElement("script");p.setAttribute("type","text/javascript");p.setAttribute("src",q);var o=document.getElementsByTagName("head").item(0);o.appendChild(p)};n.geocodeAddressAndSaveCoords=function(p,r){var o="myPlaceGeocodeCallback"+r;var q=a.bingmapCredentials;var s="/web/20130109003417/http://dev.virtualearth.net/REST/v1/Locations?q="+p.addressname+"&key="+q+"&jsonp="+o;n.callGeocodeRESTService(s)};n.geocodeAddressAndSavePlace=function(q){var o=a.bingmapCredentials,p="/web/20130109003417/http://dev.virtualearth.net/REST/v1/Locations?q="+q+"&key="+o+"&jsonp=myc21Places.GeocodeCallbackSavePlace";n.callGeocodeRESTService(p)}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.HeatMapLayer=function(e,i){var l=this,k=i,m=[],j=function(p,n,o,s){var q=new c.Polygon(p,{fillColor:n,strokeColor:new c.Color(200,255,255,255),strokeThickness:0}),r=d(".overlayToolTip");k.push(q);m.push(q);c.Events.addHandler(q,"mouseover",function(x){var v=x.target.getFillColor(),w=140-s*84;r.find("#overlayToolTipText").html(o);if(o!=null&&o!=""){var u=o.substr(0,o.indexOf("<br>"));if(u!=null&&u!=""){b.Track.doEvent("Hybrid Mapping","Heat Map","Hover over "+u+" on map")}}w-=(parseInt(r.css("width"),10)/2);v.a=200;x.target.setOptions({strokeThickness:2,strokeColor:new c.Color(255,50,50,50),fillColor:v});clearTimeout(window.heatMapTimeout);var t="172px";if(!d("#bottomMapTools").hasClass("selected")){t="7px"}if(!r.hasClass("shown")){r.addClass("shown").show().css({right:w}).animate({opacity:1},1000)}else{r.css({display:"block",opacity:1,right:w,bottom:t})}});c.Events.addHandler(q,"mouseout",function(u){var t=u.target.getFillColor();t.a=130;u.target.setOptions({strokeThickness:0,strokeColor:new c.Color(50,50,50,50),fillColor:t});clearTimeout(window.heatMapTimeout);window.heatMapTimeout=setTimeout(function(){r.removeClass("shown").animate({opacity:0},function(){d(this).hide()})},2000)})},h=function(r,q,n,o){var p={start:r,end:q,pos:n,mid:o};if(o){if(n<0.5){return{r:Math.max(Math.min(parseInt((2*p.pos*(p.mid[0]-p.start[0]))+p.start[0],10),255),0),g:Math.max(Math.min(parseInt((2*p.pos*(p.mid[1]-p.start[1]))+p.start[1],10),255),0),b:Math.max(Math.min(parseInt((2*p.pos*(p.mid[2]-p.start[2]))+p.start[2],10),255),0)}}p.pos-=0.5;return{r:Math.max(Math.min(parseInt((2*p.pos*(p.end[0]-p.mid[0]))+p.mid[0],10),255),0),g:Math.max(Math.min(parseInt((2*p.pos*(p.end[1]-p.mid[1]))+p.mid[1],10),255),0),b:Math.max(Math.min(parseInt((2*p.pos*(p.end[2]-p.mid[2]))+p.mid[2],10),255),0)}}return{r:Math.max(Math.min(parseInt((p.pos*(p.end[0]-p.start[0]))+p.start[0],10),255),0),g:Math.max(Math.min(parseInt((p.pos*(p.end[1]-p.start[1]))+p.start[1],10),255),0),b:Math.max(Math.min(parseInt((p.pos*(p.end[2]-p.start[2]))+p.start[2],10),255),0)}},g=function(n,r,u){var s=u-r,v=(n-r)/s,t=[0,255,255],o=[255,0,0],p=[255,255,0],q=h(t,o,v,p);return new c.Color(130,q.r,q.g,q.b)},f=function(){};f();l.addMapLocation=function(p,t,r,q,o){var n=g(t,r,q),s=(t<=r?0:(t>=q?1:((t-r)/(q-r))));j(p,n,o,s)};l.clearHeatMap=function(){d(".heatMapLegend").hide();d.each(m,function(o,n){k.remove(n)})}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.SurroundingAreaMapLayer=function(C,D,f){var s=new c.EntityCollection({zIndex:1}),g=null,r=[],m={},u={hover:1,selected:2,primary:3},t={1:"#3A7479",2:"#FFC400",3:"#000000"},z={},n=this,h=0,j=C,i,B=[],y=0,o={PROPERTIES:0,OFFICES:1,AGENTS:2},A,l,E,p=function(){A=new window.ImageCache();l=A.add("/images/surroundingarea/plus.png");E=A.add("/images/surroundingarea/ex.png");A.load()},x=function(G){var F=!!window.HTMLCanvasElement,J=17;if(F){var S=45,H=document.createElement("canvas");H.setAttribute("height",J);H.setAttribute("width",J);G.appendChild(H);if(window.G_vmlCanvasManager!=undefined){G_vmlCanvasManager.initElement(H)}var T=H.getContext("2d");var R=J,O=R/2,Q=true,P=false,N=d("<div style='position: absolute;' />");A.onLoad(function(){T.drawImage(l.img,0,0,R,R)});var I=function(U){T.save();T.setTransform(1,0,0,1,0,0);T.clearRect(0,0,R,R);T.translate(O,O);T.rotate(-U*Math.PI/180);T.drawImage(l.img,-O,-O);T.rotate(-U*Math.PI/180);T.globalAlpha=U/S;T.drawImage(E.img,-O,-O);T.restore()},M=function(){P=true;N.stop().animate({left:S},{duration:300,easing:"easeOutQuad",step:I,complete:function(){I(S,true);P=false;Q=false}})},K=function(){P=true;N.stop().animate({left:0},{duration:300,easing:"easeOutQuad",step:I,complete:function(){T.drawImage(l.img,0,0,R,R);P=false;Q=true}})}}else{var L=document.createElement("img");L.setAttribute("height",J);L.setAttribute("width",J);G.appendChild(L);A.onLoad(function(){L.src=l.img.src});var M=function(){L.src=E.img.src},K=function(){L.src=l.img.src}}return{open:M,close:K}},q=function(M,O){var ag=function(ai){var ak=0;for(var aj=ai.length;aj--;){ak+=Math.abs(ai[aj])^2}return Math.sqrt(ak)},L=function(aj,al){var ai=[];for(var ak=aj.length;ak--;){ai=ai.concat(aj[ak])}return ai},U=function(ai,aj){return[(ai[0][0]*aj[0])+(ai[0][1]*aj[1]),(ai[1][0]*aj[0])+(ai[1][1]*aj[1])]},P=function(ai){return[[Math.cos(ai),-Math.sin(ai)],[Math.sin(ai),Math.cos(ai)]]},ae=function(ai,aj){return ai[aj][0][0]},ad=function(ai,aj){return ai[aj][0][1]},ac=function(ai,aj){return ai[aj][1][0]},aa=function(ai,aj){return ai[aj][1][1]},V=function(ai,aj){return ai[aj][2]},N=function(al,an){var ar=-1,ap=al[an],aq=ap[0],ao=ap[1];for(var am=al.length;am--;){var ak=al[am],aj=ak[0],ai=ak[1];if((Math.max(aq[0],aj[0])<Math.min(aq[1],aj[1]))&&(Math.max(ao[0],ai[0])<Math.min(ao[1],ai[1]))){ar++}}return ar},Z=function(am,ai){var aq=-1,ap=ai[0],ao=ai[1];for(var an=am.length;an--;){var ak=am[an],al=ak[0],aj=ak[1];if((Math.max(ap[0],al[0])<Math.min(ap[1],al[1]))&&(Math.max(ao[0],aj[0])<Math.min(ao[1],aj[1]))){aq++}}return aq},J=function(aj){var ai=0,al=0;for(var ak=aj.length;ak--;){al=N(aj,ak);ai=Math.max(al,ai)}return ai},F=function(ai,aj){return[1/2*ad(ai,aj)+ae(ai,aj),1/2*aa(ai,aj)+ac(ai,aj)]},H=function(aj){var am=0,al=0,ai;for(var ak=0;ak<aj.length;ak++){ai=F(aj,ak);am+=ai[0];al+=ai[1]}return[am/aj.length,al/aj.length]},G=function(ak,aj){var ai=[];for(var al=ak.length;al--;){ai.push([[ae(ak,al)-aj,ad(ak,al)+aj],[ac(ak,al)-aj,aa(ak,al)+aj],V(ak,al)])}return ai},T=function(ak){var aj=[];for(var am=ak.length;am--;){aj.push([Z(ak,ak[am]),am])}var ai=aj.sort(function(ap,ao){return ao[0]-ap[0]});var al=[];for(var an=0;an<ai.length;an++){al.push(ak[ai[an][1]])}return al},af=function(aj,ao,ai,ar){var ap=window.g_matrixTmpCache[aj];if(!ap){ap=window.g_matrixTmpCache[aj]=P(aj)}var an=U(ap,ao),aq=ai*an[0],am=ai*an[1],al=ar[0],ak=ar[1];return[[al[0]+aq,al[1]+aq],[ak[0]+am,ak[1]+am],ar[2]]},M=G(M,O),Q=[],Y=Math.PI/12,I=Math.PI/4;window.g_matrixTmpCache={};while(J(M)>0){M=T(M);Q.unshift(M[0]);M.splice(0,1)}while(Q.length!=0){var ab=H(M);var R=F(Q,0);R[0]-=ab[0];R[1]-=ab[1];var W=L(Q.slice(0,1));Q.splice(0,1);var ah=1,S=O;var K=W;while(Z(M,K)!=-1){for(var X=0;X<I;X+=Y){K=af(X,R,S,W);if(Z(M,K)==-1){break}K=af(-X,R,S,W);if(Z(M,K)==-1){break}K=af(Math.PI+X,R,S,W);if(Z(M,K)==-1){break}K=af(Math.PI-X,R,S,W);if(Z(M,K)==-1){break}}ah++;S=ah*O}M.unshift(K)}return G(M,-O)},k=function(G,F){d.each(G,function(J,L){F.fillStyle="rgba(0,0,0,0.5)";var I=G[J][0][0],O=G[J][1][0],N=G[J][0][1],M=G[J][1][1],K=N-I,H=M-O;F.fillRect(I,O,K,H);F.strokeStyle="black";F.lineWidth=2;F.strokeRect(I,O,K,H)})},w=function(){var G=[];d.each(z,function(K,M){var O=M.width/2,J=M.height/2,L=new c.Location(M.lat,M.lon),I=j.tryLocationToPixel(L,c.PixelReference.control),H=I.x,N=I.y;G.push([[-O+H,O+H],[-J+N,J+N],{pin:M.rawPin,halfWidth:O,halfHeight:J}])});var F=q(G,0.05);d.each(F,function(M,O){var K=O[0][0],J=O[1][0],I=O[0][1],H=O[1][1],L=O[2],P=new c.Point(K+L.halfWidth,J+L.halfHeight),N=j.tryPixelToLocation(P,c.PixelReference.control);if(P!=null){L.pin.setLocation(N);L.pin.ShowInfoBox()}else{console.debug("got null for",P.x,P.y)}})},e=function(){j.entities.push(s);i=d("#bingMap");p();var F=false;c.Events.addHandler(j,"viewchangeend",function(){var G=j.getZoom();if(G!=y){F=true;y=G;setTimeout(function(){w()},50)}})},v=function(F){return"surroundingAreaPin_"+F};e();this.addSurroundingAreaPin=function(ak,Q){h++;var R=d("#lqSearchType").val(),S=o[R],M=d("#surroundingAreaSearchType").val(),N="",ag="",J=(ak.location==surroundingAreasMapping.getPrimaryAreaLocation()),ad=surroundingAreasMapping.isAreaSelected(ak.lid),K,F=v(ak.lid);switch(S){case o.PROPERTIES:ag="pid";N="Properties";K="propertycount";break;case o.OFFICES:ag="oid";N="Offices";K="officecount";break;default:case o.AGENTS:ag="aid";N="Agents";K="agentcount";break}var L=ak.displayName;if(M=="Neighborhood"&&L.length>0){var O=L.split(",");if(O!=null&&O.length>0){L=O[0]}}var al=['<div id="',F,'" class="surroundingArea ',J?"mainArea":"notSelected",'">','<span class="areasOnMap">',J?"&nbsp;":"Add &nbsp;<br />",N,"</span>",'<span class="areaName">',L,"</span>","</div>"].join(""),aj=d(al);i.append(aj);var ae=aj.outerWidth();aj.remove();var P=j.AddInfobox(Q,{width:ae,height:10,infobox:aj,htmlContent:"&nbsp;"});B.push(P);P.ShowInfoBox();var ai=false,I=false,T=J?0:19,X=aj.width()+T,an=aj.find(".areasOnMap"),Y=aj.find(".areaName"),ab=J?null:x(Y.get(0)),V=-14,ac=an.width(),aa=function(){ak=surroundingAreasMapping.getSurroundingArea(ak.location);var ao=ak[K];an.html((ad||J)?ao:"Add "+ao+"<br />"+N)},Z=function(ao){if(J){return}n.setPolygonsVisible(ak,ao)},W=function(){I=true;ai=true;var ap=portalAjax.getParameters();var ao=ap.lid;ap.sa="";ap.s="";ap.rpp="";ap.ret=ag;ap.zoom=18;ap.bounds=1;ap.lid=ak.lid;ap.t=S;var aq=surroundingAreasMapping.getSelectedSurroundingAreas();if(aq&&aq.length>0){ao=ao+","+aq}if(ao){if(ao.indexOf(ap.lid+",")!=-1){ao=ao.replace(ap.lid+",","")}else{if(ao.indexOf(","+ap.lid)!=-1){ao=ao.replace(","+ap.lid,"")}else{ao=ao.replace(ap.lid,"")}}}ap.deltalid=ao;b.portalAjax.doViewEngineAjax(ak.lid,"/counts.c21",d.param(ap),{cache:true,callback:function(){ai=false;aa();Z(I)}});aj.addClass("hover");an.stop().animate({marginLeft:X+V},{duration:300,easing:"easeOutQuad"})},H=function(){I=false;if(!ai){Z(false)}aj.removeClass("hover");an.stop().animate({marginLeft:X+V-ac},{duration:300,easing:"easeOutQuad"})},af=function(ao){if(ao){aj.parent().css({zIndex:10000})}else{aj.parent().css({zIndex:""})}},am=function(ao){af(ao);if(aj.hasClass("selected")){return}if(ao){W()}else{H()}},U=function(){ad=true;aj.removeClass("notSelected");aj.addClass("selected");an.html("&nbsp;");W();ab.open()},G=function(){ad=false;aj.addClass("notSelected");aj.removeClass("selected");aa();Z(true);ab.close()},ah=function(ao){if(ao){U()}else{G()}};if(J){n.addLocationPolygons(surroundingAreasMapping.getPrimaryArea(),u.primary);W()}else{if(ad){U()}aj.hover(function(){z[ak.lid].doHover(true);surroundingAreasMapping.addHoverSurroundingAreaCheckbox(ak.lid)},function(){z[ak.lid].doHover(false);surroundingAreasMapping.removeHoverSurroundingAreaCheckbox(ak.lid)});aj.click(function(){var ao=surroundingAreasMapping.toggleSelectedSurroundingArea(ak.lid);z[ak.lid].doCheck(ao)})}return{doCheck:ah,doHover:am,lat:ak.lat,lon:ak.lon,height:Y.outerHeight(),width:Y.outerWidth(),rawPin:P}};this.addPolygon=function(F,G,H){var I=new c.Polygon(F,n.getPolygonOptions(G));s.push(I);r.push(I);m[H].push(I)};this.getPolygonOptions=function(I){if(I){var G=0.3,J=0.7,F=t[I],H=new Microsoft.Maps.Color.fromHex(F);H.a=G*255;return{fillColor:H,strokeColor:new c.Color(0,0,0,0),strokeThickness:0}}else{return{visible:false}}};this.clearSurroundingAreas=function(){s.clear();h=0;r=[];m={};d.each(r,function(G,F){s.remove(F)});B=[];j.ClearInfoboxes();if(g==null){g=d("<div id='surroundingAreasOverlay' style='position: absolute; left: 0; top: 0;'></div>");i.append(g)}else{g.empty()}z={}};this.createPins=function(){var G=surroundingAreasMapping.getSurroundingAreas(),H=surroundingAreasMapping.getSelectedSurroundingAreas(),F=[];d.each(G,function(J,K){var I=K.lid,L=new c.Location(K.lat,K.lon);z[I]=n.addSurroundingAreaPin(K,L);F.push(L)});d.each(H,function(J,I){z[I].doCheck(true)});D.setViewFromLocations(F)};this.render=function(){n.clearSurroundingAreas();n.createPins();w()};this.setPolygonsVisible=function(I,G){var L=m[I.location],F=I.lid,K=surroundingAreasMapping.isAreaSelected(F),J=(G)?(K)?u.selected:u.hover:false;if(L){var H=n.getPolygonOptions(J);H.visible=G;d.each(L,function(M,N){N.setOptions(H)})}else{n.addLocationPolygons(I,J)}};this.addLocationPolygons=function(G,F){m[G.location]=[];d.each(G.polygons,function(K,J){var I=J.split("|"),H=[];d.each(I,function(Q,O){var L=O.split(","),P=L[1],N=L[0],R=parseFloat(P),M=parseFloat(N),S=new c.Location(R,M);H.push(S)});n.addPolygon(H,F,G.location)})};this.setChecked=function(G,F){z[G].doCheck(F)};this.setHover=function(G,F){z[G].doHover(F)}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.LocationBoundaryMapLayer=function(i){var f=this,h=new c.EntityCollection({zIndex:0.5}),k=[],g=i,j=function(p,m,q){var l=0.2,o=new c.Color.fromHex(m),n=new c.Color.fromHex("#ff0000");o.a=l*255;n.a=0;var r=new c.Polygon(p,{fillColor:o,strokeColor:n,strokeThickness:0});h.push(r);k.push(r)},e=function(){g.entities.push(h)};e();f.addMapLocation=function(m,n){var l="#003040";j(m,l,n)};f.clearLocationBoundaryMap=function(){d.each(k,function(m,l){h.remove(l)})}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.TooltipManager=function(B,k){var v=this,n=B,u=d.extend({hoverOffset:{x:0,y:0,tip:0},clickOffset:{x:0,y:0,tip:0},initClickTooltip:function(){},initHoverTooltip:function(){},onShowTooltip:function(C){},onHideTooltip:function(C){},onShowClickTooltip:function(C){},onHideClickTooltip:function(C){},onShowHoverTooltip:function(C){},onHideHoverTooltip:function(C){}},k),e,A,s=true,h=true,m=d.Deferred(),z=d.Deferred(),w=u.hoverTemplate,j=u.clickTemplate,y,g=function(D,L,I,K){var M=n.tryLocationToPixel(D.getLocation(),c.PixelReference.control);if(!M){L.hide();return false}var E=L.outerWidth(),F=d("#panelToggleControl").hasClass("closed")?349:0,J=M.x-(E/2)+I.x-F,H=M.y-L.outerHeight()+I.y,G=L.find(".contentTip"),C=d("#mapContainer");if(M.y<0||M.x<0||M.x>C.width()||M.y>C.height()){K()}if(M.x+480-F+(E/2)+16>=d(window).width()){L.css({left:"auto",top:H,right:0});G.css({left:E-(d(window).width()-(M.x+480-F))-I.tip})}else{L.css({right:"auto",left:J,top:H});G.css({left:"50%"})}return{x:J,y:H}},o=function(){if(e){e.getCard().removeClass("hover")}},q=function(){if(m.state()!="resolved"){m.reject()}},l=function(){q();h=true;n.clickHidden=true;if(j!=null){j.hide()}u.onHideTooltip(A);u.onHideClickTooltip(A)},t=function(){if(!A){return}return g(A,j,u.clickOffset,l)},r=function(){if(!e){return}return g(e,w,u.hoverOffset,v.hideHoverTooltip)},x=function(){if(z.state()!="resolved"){z.reject();y=false}},i=function(C){u.initClickTooltip(j,C);j.find(".hoverCover").stop(true).show().css({opacity:1}).animate({opacity:0},500,function(){j.find(".hoverCover").hide()});if(C==e){v.hideHoverTooltip()}u.onShowTooltip(A);u.onShowClickTooltip(A)},p=function(F,H,G,E){var D;if(E){var C=w.css("top");D=r();w.css("top",C)}if(F){D=r();w.stop(true).show();D=r();if(!D){return}w.css({top:D.y+10}).animate({top:D.y},500)}if(H){w.find(".hoverCover").show().css({opacity:1})}if(G){w.find(".hoverCover").animate({opacity:0},500,function(){w.find(".hoverCover").hide()});u.onShowTooltip(e);u.onShowHoverTooltip(e)}},f=function(){var C=n.getRootElement().parentNode;d(C).append(w).append(j);c.Events.addHandler(n,"viewchange",function(){t();r()})};v.showClickTooltip=function(C){q();A=C;h=false;n.clickHidden=false;j.show().find(".hoverCover").stop(true).show().css({opacity:1});t();v.hideHoverTooltip();m=d.Deferred();u.getClickHtml(C).then(m.resolve);m.then(function(D){j.html(D);i(C)})};v.hideTooltipByPinData=function(C){if((A==C)&&(!h)){l()}if((e==C)&&(!s)){v.hideHoverTooltip()}};v.showHoverTooltip=function(C){if(!n.clickHidden){return}o();C.getCard().addClass("hover");if(C.Latitude===undefined){e=C;return}if(C==A){if(!h){return}}if((y)&&(C==e)){if(!s){return}p(true,true,true)}else{y=true;x();z=d.Deferred();u.getHoverHtml(C).then(z.resolve);e=C;s=false;p(true,true,false);z.then(function(D){w.html(D);u.initHoverTooltip(w,C);p(false,false,true,true)})}};v.hideHoverTooltip=function(){if(!(!h&&(e==A))){u.onHideTooltip(e);u.onHideHoverTooltip(e)}s=true;w.stop(true).hide();o();x()};v.clear=function(){v.hideHoverTooltip();l()};f()}});window.Century21.Setup.mapModule(function(d,b,a,c){a.getZindexFromLoc=function(h,g){var e=h,f=parseFloat(e);return Math.floor(100000-(f*1000))}});window.Century21.Setup.mapModule(function(d,b,a,c){a.HeatMapAjax=function(g){var e=this,f,i=function(n){n=Math.round(n).toString();var j=n.split("."),m=j[0],k=j.length>1?"."+j[1]:"",l=/(\d+)(\d{3})/;while(l.test(m)){m=m.replace(l,"$1,$2")}return"$"+m+k},h=function(j,k){g.clearHeatMap();d.each(j.locations,function(l,m){d.each(m.polygons,function(q,w){var u=w.split("|"),t=[],x=(m.meta)?m.meta[k]:null;d.each(u,function(D,B){var y=B.split(","),C=y[1],A=y[0],E=parseFloat(C),z=parseFloat(A),F=new c.Location(E,z);t.push(F)});if(x){var n=0,p=100,s=x,r="",o="";switch(k){case"medianAge":n=20;p=60;s=x.toFixed(1)+" years old";r="< 20";o="60+";break;case"medianHomePrice":n=30000;p=500000;r="< $30K";o="$500K+";s=i(x);break;case"medianIncome":n=10000;p=200000;r="< $10K";o="$200K+";s=i(x);break}d(".heatMapLegend").show();d("#legendLowRange").text(r);d("#legendHighRange").text(o);var v=m.meta.name+", "+l+"<br>"+s;g.addMapLocation(t,x,n,p,v)}})})};e.getData=function(k,j){f=d.ajax({dataType:"json",data:{xy:k.xy,mx:k.mx,my:k.my,xx:k.xx,zoom:k.zoom,submitted:true,subView:"HeatMapSearch"},url:"/heatmap.c21?",success:function(l){h(l,j.meta);if(j.success){j.success()}},error:j.error})};e.cancel=function(){if(f){f.abort()}}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.LocationBoundaryMapAjax=function(g){var e=this,f,h=function(i){var j=[];g.clearLocationBoundaryMap();if(i){d.each(i.locations,function(k,l){d.each(l.polygons,function(o,n){var m=n.split("|"),p=[];d.each(m,function(v,t){var q=t.split(","),u=q[1],s=q[0],w=parseFloat(u),r=parseFloat(s),x=new c.Location(w,r);p.push(x);j.push(x)});g.addMapLocation(p,k)})})}return j};e.getData=function(l,k,j){var i=j||{},m=i.data||{};f=d.ajax({dataType:"json",data:d.extend({lids:k,zoom:l.zoom+3,px:b.portalResults.getMapBoundaries(l),submitted:true,subView:"LocationBoundaryMapSearch"},m),url:"/locationboundarymap.c21",success:function(n){var o=h(n);if(i.success){i.success(o)}},error:function(n,p,o){}})};e.cancel=function(){if(f){f.abort()}}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.UniqueLocationStore=function(){var e=this,f={};e.has=function(h,i){var g=false;d.each(f,function(j,k){if(k.lat==h){if(k.lon==i){g=true;return false}}});return g};e.add=function(g,h){if(!e.has(g,h)){f.push({lat:g,lon:h});return true}return false};e.clear=function(){f=[]}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.AgentPinLayer=function(i,g){var f=this,l=new c.EntityCollection({zIndex:4}),h=i,k=new a.UniqueLocationStore(),j=function(o){var p=o.getLocation(),m=new c.Pushpin(p,{icon:"/images/mapping/agent-pushpin-icon.png",width:42,height:61,typeName:"officePin",zIndex:a.getZindexFromLoc(o.getLatitude(),o.getLongitude()),anchor:new c.Point(20,59)}),n=new c.Pushpin(p,{icon:"/images/mapping/agent-pushpin-shadow.png",width:61,height:61,typeName:"officePin",zIndex:1,anchor:new c.Point(20,59)});a.onPinHoverIntent(h,m,function(){b.Track.doEvent("Hybrid Mapping","Agent Map","Hover over an office on the map");g.showHoverTooltip(o)},function(){g.hideHoverTooltip()});c.Events.addHandler(m,"click",function(q){b.Track.doEvent("Hybrid Mapping","Agent Map","Click on an office on the map");g.showClickTooltip(o)});l.push(m);l.push(n)},e=function(){h.entities.push(l);a.onMapClick(h,function(m){g.clear()})};f.setOffices=function(m){f.clearOffices();d.each(m,function(n,o){if(!k.add(o.getLatitude(),o.getLongitude())){return}j(o)})};f.clearOffices=function(){l.clear();k.clear();g.clear()};e()}});window.Century21.Setup.mapModule(function(d,b,a,c){a.OfficePinLayer=function(i,h){var f=this,l=new c.EntityCollection({zIndex:4}),g=i,k=new a.UniqueLocationStore(),j=function(o){var p=o.getLocation(),m=new c.Pushpin(p,{icon:"/images/mapping/office-pushpin-icon.png",width:42,height:60,typeName:"officePin",zIndex:a.getZindexFromLoc(o.getLatitude(),o.getLongitude()),anchor:new c.Point(20,59)}),n=new c.Pushpin(p,{icon:"/images/mapping/office-pushpin-shadow.png",width:63,height:60,typeName:"officePin",zIndex:1,anchor:new c.Point(20,59)});a.onPinHoverIntent(g,m,function(){b.Track.doEvent("Hybrid Mapping","Office Map","Hover over an office on the map");h.showHoverTooltip(o)},function(){h.hideHoverTooltip()});c.Events.addHandler(m,"click",function(q){b.Track.doEvent("Hybrid Mapping","Office Map","Click on an office on the map");h.showClickTooltip(o)});l.push(m);l.push(n)},e=function(){g.entities.push(l);a.onMapClick(g,function(m){h.clear()})};f.setOffices=function(m){f.clearOffices();d.each(m,function(n,o){if(!k.add(o.getLatitude(),o.getLongitude())){return}j(o)})};f.clearOffices=function(){l.clear();k.clear();h.clear()};e()}});window.Century21.Setup.mapModule(function(d,b,a,c){a.onMapClick=function(g,f){var e=false;c.Events.addHandler(g,"mousedown",function(h){e=false});c.Events.addHandler(g,"viewchangestart",function(h){e=true});c.Events.addHandler(g,"mouseup",function(h){if(e){return}f(h)})}});window.Century21.Setup.mapModule(function(d,b,a,c){a.onPinHoverIntent=function(j,f,i,g){var h=500,e=0;j.iTimeoutMouseOver=0;c.Events.addHandler(f,f.getTitle?"mouseenter":"mouseover",function(k){clearTimeout(j.iTimeoutMouseOver);clearTimeout(e);j.iTimeoutMouseOver=setTimeout(i,h)});c.Events.addHandler(f,f.getTitle?"mouseleave":"mouseout",function(k){clearTimeout(j.iTimeoutMouseOver);clearTimeout(e);e=setTimeout(g,h)})}});window.Century21.Setup.mapModule(function(d,b,a,c){a.SchoolPinLayer=function(f,K,F){var p=this,s={},A={},l={},C={},M={},g,h,E={},z=false,m={active:1,normal:2,gold:3},I=1.609344,t=new c.EntityCollection({zIndex:1}),r=new c.EntityCollection({zIndex:6}),v=new c.EntityCollection({zIndex:7}),J=K,y=f,B=function(P,Q){var R=P.getId(),O=new c.Pushpin(Q,{zIndex:a.getZindexFromLoc(Q.latitude,Q.longitude),icon:"/images/schoolsearch/pin-gold.png",width:63,height:63,anchor:new c.Point(5,18)});a.onPinHoverIntent(J,O,function(){Track.doEvent("Schools","Mapping Page","Hover over a school pushpin");F.showHoverTooltip(P);p.setPinHighlighted(R,true)},function(){F.hideHoverTooltip();p.setPinHighlighted(R,false)});c.Events.addHandler(O,"click",function(S){Track.doEvent("Schools","Mapping Page","Click on a school pushpin");F.showClickTooltip(P)});return O},i=function(Q){var O=[];d.each(Q,function(T,V){var S=V[0],R=V[1],U=new c.Location(S,R);O.push(U)});var P=new c.Polygon(O,{fillColor:new c.Color(51,245,192,34),strokeColor:new c.Color(100,50,50,50),strokeThickness:3});return P},L={},e={},q=function(P){var O=C[P];if(L[P]){r.remove(O);delete L[P]}if(!e[P]){v.push(O);e[P]=true}},k=function(P){var O=C[P];if(e[P]){v.remove(O);delete e[P]}if(!L[P]){r.push(O);L[P]=true}},D=function(P){var O=C[P];if(e[P]){v.remove(O);delete e[P]}if(L[P]){r.remove(O);delete L[P]}},x=function(){L={};e={};r.clear();v.clear()},o=function(Q,O){var P=A[Q];A[Q]=O;return(P===O)},j=function(P,O){if(o(P,m.active)){return}q(P);O.setOptions({icon:"/images/schoolsearch/apple-pin-active.png",width:63,height:63,visible:true,anchor:new c.Point(19,58)})},N=function(P,O){if(o(P,m.normal)){return}q(P);O.setOptions({icon:"/images/schoolsearch/apple-pin-normal.png",width:63,height:63,visible:true,anchor:new c.Point(19,58)})},w=function(P,O){if(o(P,m.gold)){return}k(P);O.setOptions({icon:"/images/schoolsearch/pin-gold.png",width:0,height:0,visible:false,anchor:new c.Point(5,18)})},H=function(Q){var O=C[Q],P=(Q==g);if(E[Q]){j(Q,O)}else{if(z){if(M[Q]){if(P){j(Q,O)}else{N(Q,O)}}else{w(Q,O)}}else{D(Q)}}},u=function(Q,P){var O=l[Q];if(!O){return}if(E[Q]){P=true}O.setOptions({visible:P})},G=function(R){var U=R.getId();if(C[U]){return}var Q=R.getLatitude(),P=R.getLongitude(),S=new a.PinData(U,Q,P),T=S.getLocation(),O=B(S,T);C[U]=O;s[U]=S;H(U)},n=function(){var O=new b.PortalParams(),P=O.get("sn");if(P){I=(P*1.609344);d("#schoolRadiusSelector").val(P)}E={};F.setLayer(p);J.entities.push(t);J.entities.push(r);J.entities.push(v);a.onMapClick(J,function(Q){F.clear()})};n();p.getSchools=function(){return s};p.setSchoolsInView=function(P){var O={};d.each(P,function(Q,R){O[R]=true;if(!M[R]){M[R]=true;H(R)}});d.each(M,function(S,Q){if(!O[S]){if(!E[S]){var R=s[S];F.hideTooltipByPinData(R);delete M[S];H(S)}}})};p.setSchools=function(O){z=true;d.each(C,function(R,Q){if(!E[R]){D(R);var P=l[R];if(P){P.setOptions({visible:false})}delete C[R];delete l[R];delete s[R];delete M[R];delete A[R]}});d.each(O,function(P,Q){G(Q)})};p.setSchoolRadius=function(O){I=O};p.setInitialSelectedSchools=function(O){E={};d.each(O,function(Q,R){var S=R.getId(),P=R.getBoundary();E[S]=true;G(R);p.addShape(S,P)})};p.setSelectedSchools=function(O){d.each(E,function(Q,P){delete E[Q];H(Q);u(Q,false)});g=false;d.each(O,function(P,Q){E[Q]=true;H(Q);u(Q,true)})};p.hideUnselectedSchools=function(){z=false;r.setOptions({visible:false});d.each(M,function(Q,O){if(!E[Q]){if(g!=Q){var P=C[Q];P.setOptions({visible:false})}}});d.each(s,function(P,O){if(!E[P]){F.hideTooltipByPinData(O)}})};p.showUnselectedSchools=function(){z=true;r.setOptions({visible:true});d.each(M,function(Q,O){var P=C[Q];P.setOptions({visible:true})})};p.setPinHighlighted=function(P,O){if(h){return}g=(O)?P:null;if(C[P]){H(P)}};p.addShape=function(T,S){var O,P=s[T],R=P.getLocation(),Q=l[T];if(Q){t.remove(Q);delete l[T]}if(S.length<2){O=y.getCircle(R,I,750,"#323232",3,0.4,"#F5C022",0.2)}else{O=i(S)}t.push(O);l[T]=O};p.getPinData=function(O){return s[O]};p.setClickPin=function(P,O){var Q=P.getId();if(O){g=Q;h=Q;H(Q)}else{g=null;h=null;H(Q)}};p.setShapeVisibility=function(Q,O){var P=Q.getId();u(P,O)};p.clearSchools=function(){A={};s={};l={};C={};M={};g=false;h=false;E={};z=false;t.clear();x();F.clear()}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.ResultPropertyPinLayer=function(j,f){var g=this,i,l=new c.EntityCollection({zIndex:4}),h=j,k=function(n,o){var m=new c.Pushpin(o,{icon:"/images/mapping/property-pushpin-gold.png",width:49,height:32,text:n.getShortPrice(),typeName:"propertyPin",zIndex:a.getZindexFromLoc(o.latitude,o.longitude),anchor:new c.Point(11,31)});a.onPinHoverIntent(h,m,function(){b.Track.doEvent("Hybrid Mapping","Property Map","Hover over a property on the map");f.showHoverTooltip(n)},function(){f.hideHoverTooltip()});c.Events.addHandler(m,"click",function(p){b.Track.doEvent("Hybrid Mapping","Property Map","Click on a property on the map");f.showClickTooltip(n)});return m},e=function(){h.entities.push(l);a.onMapClick(h,function(m){f.clear()})};e();g.getProperties=function(){return i};g.setProperties=function(m){i=m;l.clear();d.each(m,function(o,p){var q=p.getLocation(),n=k(p,q);l.push(n)})};g.clearProperties=function(){l.clear();i=[];f.clear()}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.BackgroundPropertyPinLayer=function(f,h){var m=this,j=f,n,e=false,l,k=function(p,o){var q=new c.Pushpin(o,{icon:"/images/mapping/property-pushpin-cluster.png",zIndex:a.getZindexFromLoc(o.latitude,o.longitude),width:27,height:32,text:p.length.toString(),typeName:"clusterPin",anchor:new c.Point(8,31)});c.Events.addHandler(q,"click",function(t){var r=[];d.each(p,function(u,w){var v=w.getLocation();r.push(v)});var s=c.LocationRect.fromLocations(r);j.setView({bounds:s})});return q},i=function(p){var o=new c.Pushpin(p._LatLong,{icon:"/images/mapping/grey-pushpin.png",zIndex:a.getZindexFromLoc(p.getLatitude(),p.getLongitude()),width:23,height:18,typeName:"propertyPin",anchor:new c.Point(6,18)});a.onPinHoverIntent(j,o,function(){b.Track.doEvent("Hybrid Mapping","Property Map","Hover over a property on the map");h.showHoverTooltip(p,true)},function(){h.hideHoverTooltip()});c.Events.addHandler(o,"click",function(q){b.Track.doEvent("Hybrid Mapping","Property Map","Click on a property on the map");h.showClickTooltip(p)});return o},g=function(){a.onMapClick(j,function(o){h.clear()})};g();m.setProperties=function(o){if(e){n.SetData(o)}else{l=function(){n.SetData(o)}}};m.clearProperties=function(){m.setProperties([]);h.clear()};m.onClusterModuleLoaded=function(){n=new window.ClusteredEntityCollection(j,{singlePinCallback:i,clusteredPinCallback:k});var o=n.GetLayer();o.setOptions({zIndex:3});e=true;if(l){l()}}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.PropertyPinAjax=function(g,h){var e=this,f,i=function(j){h.setProperties(j)};e.getData=function(k,j){f=d.ajax({dataType:"json",data:d.extend({xy:k.xy,mx:k.mx,my:k.my,xx:k.xx},j.refine),url:"/csjson/propertysearchgeo",success:function(m){var n=[],l=g.getProperties();d.each(m.points,function(q,o){var t=o[0],u=o[1],p=o[2],s=new a.PinData(p,t,u);var r=false;d.each(l,function(v,w){if(w.getId()==p){r=true;return false}});if(!r){n.push(s)}});i(n)},error:function(l,n,m){if(n=="abort"){return}}})};e.cancel=function(){if(f){f.abort()}}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.PinData=function(g,m,f,i){var o=this,h=g,j=m,n=f,l=i||{},k=l.card||d(),e=l.shortPrice;o.getId=function(){return h};o.getLatitude=function(){return j};o.getLongitude=function(){return n};o.getLocation=function(){return new c.Location(j,n)};o.getShortPrice=function(){return e};o.getCard=function(){return k};o.getData=function(p){return l[p]};o.Latitude=m;o.Longitude=f}});window.Century21.Setup.mapModule(function(d,b,a,c){a.Map=function(E,H){var r=this,u=true,L=false,K=new a.LassoTool("lassoTool",r),v=new c.EntityCollection({zIndex:2}),V=null,ap=new a.AreaOverlayUi(),T=E.get(0),y=d.extend({lockAutoZoomToPins:false},H||{}),Y=new c.Map(T,{credentials:a.bingmapCredentials,bounds:y.bounds,center:y.center,zoom:y.zoom,mapTypeId:c.MapTypeId.auto,customizeOverlays:true,enableSearchLogo:false}),S,aa,z,af=y.lockAutoZoomToPins,U=new a.BackgroundPropertyTooltipManager(Y),P=new a.ResultPropertyTooltipManager(Y),Z=new a.OfficeTooltipManager(Y),x=new a.AgentTooltipManager(Y),al=new a.SchoolTooltipManager(Y),ai=new a.MyPlaceTooltipManager(Y),h=new a.SurroundingAreaTooltipManager(Y),X=new a.HeatMapLayer(Y,v),J=new a.HeatMapAjax(X),f=new a.LocationBoundaryMapLayer(Y),j=new a.LocationBoundaryMapAjax(f),ah=new a.SchoolPinLayer(r,Y,al),an=new a.SurroundingAreaMapLayer(Y,this,h),l=new a.ZoomErrorMessage(Y),s=new a.POIMapLayer(Y,l),ad=new a.MyPlacesMapLayer(r,Y,ai),Q=new a.ResultPropertyPinLayer(Y,P),am=new a.BackgroundPropertyPinLayer(Y,U),G=new a.PropertyPinAjax(Q,am),p=new a.OfficePinLayer(Y,Z),o=new a.AgentPinLayer(Y,x),e=false,aj=null,k=null,F=function(aq){var ar=(aq=="")?null:aq;b.portalAjax.setHash(b.portalAjax.getHash(),true,{poi:ar})},I=function(){var aq="";d(".pointOfInterestCheckbox").each(function(){if(d(this).attr("checked")){aq+=((aq.length>0?",":"")+d(this).val())}});return aq},M=function(){if(r.isSurroundingAreaViewSelected()){l.disable("poi");return}var aq=I();if(aq.length>0){if(l.inRange()){s.render(aq);F(aq)}else{l.enable("poi")}}else{l.disable("poi");s.render(aq);F(aq)}},ao=function(){if(!V){return}V.setOptions({visible:false});V.setOptions({visible:true})},W=function(){if(r.isSurroundingAreaViewSelected()){l.disable("heatmap");return}var ar=ap.getAreaOverlaySelection();if(ar){if(l.inRange()){l.disable("heatmap");var aq=r.getBounds();f.clearLocationBoundaryMap();J.getData(aq,{meta:ar,success:function(){ao()},error:function(at,av,au){if(av=="abort"){return}}})}else{l.enable("heatmap");f.clearLocationBoundaryMap()}}else{l.disable("heatmap");X.clearHeatMap();J.cancel();r.refreshLocationBoundaryMap()}},ae=function(){var ar=r.getBounds(),at=d("#cacheServerSearchURL").val(),aq=b.Helpers.queryToJSON(at);delete aq.rpp;delete aq.start;G.getData(ar,{refine:aq})},D=function(){am.onClusterModuleLoaded();e=true;ae()},B=function(){var ar=new b.PortalParams().getParam("poi"),aq=(ar)?ar.split(","):[];d(".pointOfInterestCheckbox").change(function(){if(d(this).attr("checked")){b.Track.doEvent("Hybrid Mapping","Points of Interest Tool","Select "+d(this).val())}else{b.Track.doEvent("Hybrid Mapping","Points of Interest Tool","Deselect "+d(this).val())}M()}).each(function(){var at=d(this);if(d.inArray(at.val(),aq)>=0){at.attr("checked","checked")}});d.uniform.update()},ac=function(){if(!V){return}v.remove(V);V=null},A=function(){var aq=d("#drawTool"),ar=d("#drawingToolInstructions");d("#saveSearchButton").css("display","inline");ac();K.stop();aq.removeClass("selected");ar.removeClass("active");r.refreshLocationBoundaryMap()},R=function(){var ar=d("#drawTool"),aq=d("#bottomMapToolsDropDown"),at=d("#drawingToolInstructions");ar.click(function(){if(ar.hasClass("selected")){b.Track.doEvent("Hybrid Mapping","Tool Bar","Deselect Drawing Tool");d("#saveSearchButton").css("display","inline");b.portalResults.removeLiquidMapDrawingToolFacet(null);ac();ar.removeClass("selected");at.removeClass("active");r.refreshLocationBoundaryMap()}else{if(l.inRange()){b.Track.doEvent("Hybrid Mapping","Tool Bar","Select Drawing Tool");d("#saveSearchButton").css("display","none");q();ar.addClass("selected");at.addClass("active").css("bottom",56+(aq.is(":visible")?160:0));var au=ar.offset(),ay=ar.height(),ax=ar.width(),aw=d("<div class='bob' />").css({position:"absolute",left:au.left.toString()+"px",top:au.top.toString()+"px",height:ay,zIndex:99999,width:ax,cursor:"pointer",backgroundColo:"green"});aw.show().click(function(){K.stop();ar.removeClass("selected");at.removeClass("active")});d(document.body).append(aw);K.start(function(){aw.hide()})}else{l.enableTemporarily("lasso")}var av=d("#selectedSchoolIds").val();if(av!=null&&av!=""){b.SchoolSearch.showSchoolDeletionModal();return}b.SchoolSearch.clearSchoolSearchCriteria();b.SchoolSearch.closeWindow()}})},O=function(){L=true;if(!r.isSurroundingAreaViewSelected()){b.Track.doEvent("Hybrid Mapping","Tool Bar","Select My Places Tool")}d("#saveSearchButton").css("display","none");d("#myPlacesTool").addClass("selected");d("#mapToolTip").hide();b.Places.getMyPlaces()},n=function(){L=false;if(!r.isSurroundingAreaViewSelected()){b.Track.doEvent("Hybrid Mapping","Tool Bar","Deselect My Places Tool")}d("#saveSearchButton").css("display","inline");d("#myPlacesTool").removeClass("selected");d("#myPlacesToolInstructions").removeClass("active");r.clearMyC21Places()},ak=function(){return L},ab=function(){var aq=d("#myPlacesTool");aq.click(function(){if(aq.hasClass("selected")){n()}else{O()}});d("#myPlacesToolInstructions .addPlaceLink").click(function(){b.Track.doEvent("Hybrid Mapping","Tool Bar","Add/Edit/View My Places");b.Places.loadMyPlacesModal()})},N=function(){return d("#searchWithinMap").attr("checked")},q=function(){d("#searchWithinMap").attr("checked",false);d("#searchWithinMap").attr("disabled","disabled")},ag=function(){if(N()){if(aj==Y.getZoom().toString()&&k.toString()==Y.getBounds().toString()){b.portalResults.changeLiquidMapSearchWithinMapFacet(true);l.disable("searchWithinMap");return}if(!l.inRange()){r.refreshLocationBoundaryMap()}if(l.inRange()){b.portalResults.changeLiquidMapSearchWithinMapFacet();l.disable("searchWithinMap")}else{b.portalResults.removeLiquidMapSearchWithinMapFacet();l.enable("searchWithinMap")}r.refreshLocationBoundaryMap();if(e){ae()}}else{l.disable("searchWithinMap")}},t=function(){l.addTool("searchWithinMap","Can not use the Search Within Map feature at this level");l.addTool("poi","There are too many points of interest to show at once.");l.addTool("heatmap","There are too many heatmap locations to show at once.");l.addTool("lasso","Can not use draw tool at this level")},m=function(){window.Ve7Infobox(Y);a.MapTypeOverlay(Y);r.updatePropertyPins();c.registerModule("clusterModule","/js/V7ClientSideClustering.js");c.loadModule("clusterModule",{callback:D});t();B();R();ab();Y.entities.push(v);ap.setClickEvent(W);aj=Y.getZoom().toString();k=Y.getBounds();c.Events.addThrottledHandler(Y,"viewchangeend",function(){l.refresh();M();W();ag();r.refreshLocationBoundaryMap()},250);W();ag()},w=function(av,aq,au,at){if(av.attr("hoverSet")==="y"){return}av.attr("hoverSet","y");var ar=av.hasClass("schoolRecord")?av:av.parent();ar.hover(function(){if(av.hasClass("schoolRecord")){Track.doEvent("Schools","School Results Dialog","Hover over a school")}else{var aw="Center Lane";var ax=d("#lqSearchType").val();if(ax=="PROPERTIES"){Track.doEvent("Hybrid Mapping","Property "+aw,at)}else{if(ax=="AGENTS"){Track.doEvent("Hybrid Mapping","Agent "+aw,at)}else{if(ax=="OFFICES"){Track.doEvent("Hybrid Mapping","Office "+aw,at)}}}}aq.showHoverTooltip(au)},function(){aq.hideHoverTooltip()})},g=function(){if(!u){return}if(!aa){return}if(!z){return}var aq=aa.concat(z);r.setViewFromLocations(aq);u=false},i=function(ar,at){r.clearAll();ae();S=at;r.refreshLocationBoundaryMap();if(ar.length>0){var aq=[];d.each(ar,function(au,av){var aw=av.getLocation();if(aw.latitude){aq.push(aw)}});if(aq.length==0){return}if(N()){r.setViewFromLocations(aq);u=false}else{if(u){aa=aq;g()}}}};r.resetFirstViewLoad=function(){af=false;u=true;z=null;aa=null};r.lockAutoZoomToPins=function(){af=true};r.unlockAutoZoomToPins=function(){af=false};r.setViewFromLocations=function(aq){if(af){return}if(N()){return}var ar=c.LocationRect.fromLocations(aq);Y.setView({bounds:ar})};r.modifyZoom=function(ar){var aq=Y.getTargetZoom();Y.setView({zoom:aq+ar})};r.setMapView=function(aq,at){var ar=new c.LocationRect.fromCorners(new c.Location(at.xy,at.mx),new c.Location(at.my,at.xx));Y.setView({bounds:ar})};r.getPOI=function(){return s};r.getCircle=function(aB,au,aF,aA,ax,aq,av,aH){var aw=6371,ay=(aB.latitude*Math.PI)/180,at=(aB.longitude*Math.PI)/180,aJ=parseFloat(au)/aw,aG=[],az=parseInt(360/aF,10)||10,aC;for(aC=0;aC<=360;aC+=az){var ar=new c.Location(0,0);var aK=aC*Math.PI/180;ar.latitude=Math.asin(Math.sin(ay)*Math.cos(aJ)+Math.cos(ay)*Math.sin(aJ)*Math.cos(aK));ar.longitude=((at+Math.atan2(Math.sin(aK)*Math.sin(aJ)*Math.cos(ay),Math.cos(aJ)-Math.sin(ay)*Math.sin(ar.latitude)))*180)/Math.PI;ar.latitude=(ar.latitude*180)/Math.PI;aG.push(ar)}var aI=new c.Color.fromHex(av);aI.a=aH*255;var aE=new c.Color.fromHex(aA);aE.a=aq*255;var aD=new c.Polygon(aG,{fillColor:aI,strokeColor:aE,strokeThickness:ax});return aD};r.getBounds=function(){var ar=Y.getBounds(),aq={xy:ar.getNorth().toString(),mx:ar.getWest().toString(),my:ar.getSouth().toString(),xx:ar.getEast().toString(),zoom:Y.getZoom()};return aq};r.getZoom=function(){return Y.getZoom()};r.updateOfficePins=function(){var aq=[];d("#listContainer").find(".CardWrapper.officeCard").each(function(){var av=d(this),au=av.find("input.officeLatitude").val(),ar=av.find("input.officeLongitude").val(),at=av.find("input.officeId").val();var aw=new a.PinData(at,au,ar,{card:av});w(av,Z,aw,"Hover over an office in the search results");aq.push(aw)});i(aq,"office");p.setOffices(aq)};r.updateAgentPins=function(){var aq=[];d("#agentSearchMapHoverState").find(".agentsSearchMapOverlay").each(function(){var at=d(this),av=at.find("input.agentsOfficeLatitude").val(),ar=at.find("input.agentsOfficeLongitude").val(),au=at.find("input.officeId").val(),ax=d(".agentOffice"+au);var aw=new a.PinData(au,av,ar,{card:d()});w(ax,x,aw,"Hover over an agent in the search results");aq.push(aw)});i(aq,"agent");o.setOffices(aq)};r.refreshMyC21Places=function(){if(L){ad.render()}};r.enableMyC21Places=function(){O()};r.disableMyC21Places=function(){n()};r.isMyPlacesEnabled=function(){return ak()},r.clearMyC21Places=function(){ad.clearMyPlaces()};r.geocodeAddressAndSavePlace=function(aq){ad.geocodeAddressAndSavePlace(aq)};r.refreshSurroundingAreaPin=function(aq){an.refreshPin(aq)};r.renderSurroundingAreas=function(){an.render()};r.setSurroundingAreaChecked=function(ar,aq){an.setChecked(ar,aq)};r.setSurroundingAreaHover=function(ar,aq){an.setHover(ar,aq)};r.clearSurroundingAreas=function(){an.clearSurroundingAreas()};r.isSurroundingAreaViewSelected=function(){return d("#surroundingAreasLiqMap").hasClass("selected")};r.clearLocationBoundaryMap=function(){f.clearLocationBoundaryMap()};r.setSchoolRadius=function(aq){ah.setSchoolRadius(aq)};r.setInitialSelectedSchools=function(aq){ah.setInitialSelectedSchools(aq)};r.setSelectedSchools=function(aq){ah.setSelectedSchools(aq)};r.showUnselectedSchools=function(){ah.showUnselectedSchools()};r.hideUnselectedSchools=function(){ah.hideUnselectedSchools()};r.deselectDrawingTool=function(){A()};r.setSchools=function(aq){ah.setSchools(aq);r.updateSchoolHoverState()};r.clearSchools=function(){ah.clearSchools()};r.setSchoolsInView=function(aq){ah.setSchoolsInView(aq)};r.updateSchoolHoverState=function(){d("#schoolSearchResults").find(".schoolRecord").each(function(){var aq=d(this),av=aq.find(".clickForSchoolDetails"),ar=aq.find(".viewSchoolDetailsLink"),au=aq.find("input.schoolID").val(),at=ah.getPinData(au);if(aq.attr("hoverSet")!=="y"){ar.click(function(){al.showClickTooltip(at)});av.click(function(){ar.click()})}w(aq,al,at,"Hover over a school")})};r.refreshLocationBoundaryMap=function(){var at=ap.getAreaOverlaySelection();if(N()||at||r.isSurroundingAreaViewSelected()){r.clearLocationBoundaryMap();return}var ar=r.getBounds(),aq=d("#searchLocationLIDS").val();if(aq==""){z=[];g()}else{j.getData(ar,aq,{success:function(au){z=au;g()}})}};r.updatePropertyPins=function(){var aq=[];d("#listContainer").find(".CardWrapper.propertyCard").each(function(){var ar=d(this),aw=ar.find("input[name=proplatitude]").val(),av=ar.find("input[name=proplongitude]").val(),au=ar.find("input[name=shortCurrency]").val(),at=ar.attr("id").replace(/property/,"");var ax=new a.PinData(at,aw,av,{shortPrice:au,card:ar});w(ar,P,ax,"Hover over a property in the search results");aq.push(ax)});i(aq,"property");Q.setProperties(aq)};r.clearAll=function(){p.clearOffices();o.clearOffices();Q.clearProperties();am.clearProperties();G.cancel();j.cancel()};r.clearTooltips=function(){U.clear();P.clear();Z.clear();x.clear();ai.clear();al.clear();h.clear()};r.clearHeatMap=function(){X.clearHeatMap();if(r.isSurroundingAreaViewSelected()){l.disable("heatmap")}};r.refreshHeatmap=function(){W()};r.clearPOI=function(){s.clearPOI()};r.refreshPOI=function(){M()};r.addLassoPoly=function(aq){var ar=new c.Polyline(aq,{fillColor:new c.Color(0,0,0,0),strokeColor:new c.Color(255,0,0,255)});d("#drawTool").addClass("selected");ac();v.push(ar);V=ar};var C=[];r.addLassoPolyByPixels=function(ar){var aq=Y.tryPixelToLocation(ar,c.PixelReference.control);C=[];d.each(aq,function(at,au){C.push(au.longitude);C.push(au.latitude)});aq.push(aq[0]);r.addLassoPoly(aq);b.portalResults.changeLiquidMapDrawingToolFacet(null,C)};r.fixAfterShow=function(){var aq=Y.getZoom();Y.setView({zoom:aq+1});setTimeout(function(){Y.setView({zoom:aq})},1000)};m()}});window.Century21.Setup.mapModule(function(d,b,a,c){a.ZoomErrorMessage=function(v){var q=this,k=v,m=d("#heatMapLabel"),j=10,u={},s=[],g=0,n=function(w){m.html(w+"<br/>Please zoom in to see updated tools.").show()},h=function(){var w=s[0],x=u[w];n(x)},r=function(w){var x=d.inArray(w,s);return x},l=function(w){return(r(w)!==-1)},i=function(w){var x=r(w);if(x>-1){s.splice(x,1)}},o=function(){n("Map features you requested are not available at this zoom level.")},p=function(){m.hide()},e=function(){return(g>j)},t=function(){if(s.length==0){p()}else{if(s.length==1){h()}else{o()}}},f=function(){};q.inRange=e;q.refresh=function(){g=k.getTargetZoom();t()};q.addTool=function(w,x){u[w]=x};q.enable=function(w){if(l(w)){return}s.push(w);t()};q.enableTemporarily=function(w){m.css({backgroundColor:"#fff",color:"black"}).animate({backgroundColor:"black",color:"white"},{easing:"easeInQuad",duration:500});q.enable(w);i(w)};q.disable=function(w){i(w);t()};f()}});window.Century21.Setup.mapModule(function(d,b,a,c){a.LassoTool=function(q,g){var u=this,l=d("#"+q),n=new window.Raphael(q),t=30,s=false,f=false,r=0,p=0,j,h,e,i;function k(w,y,v,x){var z=(v-w),A=(x-y);return Math.sqrt((z*z)+(A*A))}function m(w,v){if(h){h.remove()}h=n.path(w);h.attr({fill:"#000","fill-opacity":(v)?0:0.2,stroke:"#3b4449","stroke-dasharray":(v)?undefined:"- ","stroke-width":3,"stroke-linejoin":"round"})}function o(){s=false;h.remove();h=null}l.mousedown(function(v){if(f){return}s=true;j=null;e=[]});l.mouseup(function(){s=false;if(e.length<3){return}f=true;g.addLassoPolyByPixels(e);l.removeClass("drawing");m(j+" z",true);h.animate({opacity:0,transform:"s1.5"},500,">",function(){o();f=false;l.removeClass("showing");if(i){i()}})});l.mousemove(function(A){if(f){return}if(!s){return}var v=d(this).parent().offset(),B=A.pageX-v.left,z=A.pageY-v.top,x=B-r,D=z-p,w=k(B,z,r,p),y=" l "+x.toString()+" "+D.toString();if(j){m(j+y)}if(w>t){if(!j){j="M "+B.toString()+" "+z.toString()}else{j+=y}var C=new c.Point(B,z);e.push(C);r=B;p=z}if(e.length>90){window.alert("Your shape is too complicated. Please try drawing a more simple shape.");o()}});d(window).resize(function(){var v=l.width(),w=l.height();n.setSize(v,w)});u.start=function(v){l.addClass("drawing showing");n=new window.Raphael(q);i=v};u.stop=function(){if(i){i()}s=false;l.removeClass("showing")}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.AgentTooltipManager=function(k){var h=this,i=k,f=d("<div class='agentSummaryHoverOverlay'><div class='contentTip'></div></div>"),g=d("<div class='agentsSearchMapOverlay agentSummaryClickOverlay'><div class='contentTip'></div></div>"),j=false,l=new a.TooltipManager(i,{hoverTemplate:f,clickTemplate:g,initClickTooltip:function(m,n){m.on({mouseenter:function(){b.Track.doEvent("Hybrid Mapping","Agent Map","Hover over an agent in the office");var o=d(this);o.addClass("hover");d("#agent"+o.attr("agentId")).addClass("hover")},mouseleave:function(){var o=d(this);o.removeClass("hover");d("#agent"+o.attr("agentId")).removeClass("hover")},click:function(){if(j){return}j=true;document.location.href=d(this).find("a").eq(0).click().attr("href")}},".agentRow");b.ImageLazyLoader.loadImages()},getClickHtml:function(m){return d.Deferred(function(n){b.portalResults.getAgentSearchListForOffice(null,m.getId(),function(){var o=d("#agentsSearchMapOverlay").html();n.resolve(o)})}).promise()},getHoverHtml:function(m){return d.Deferred(function(n){var q=m.getId(),p="#agentsSearchMapHoverState_"+q,o=d(p).html();n.resolve(o)}).promise()},hoverOffset:{x:1+480,y:-70+147,tip:6},clickOffset:{x:1+480,y:-45+147,tip:5}}),e=function(){};h.showClickTooltip=l.showClickTooltip;h.showHoverTooltip=l.showHoverTooltip;h.hideHoverTooltip=l.hideHoverTooltip;h.clear=l.clear;e()}});window.Century21.Setup.mapModule(function(d,b,a,c){a.OfficeTooltipManager=function(j){var h=this,i=j,f=d("<div class='officeSummaryHoverOverlay'><div class='contentTip'></div></div>"),g=d("<div class='officeSearchMapOverlay officeSummaryClickOverlay'><div class='contentTip'></div></div>"),k=new a.TooltipManager(i,{hoverTemplate:f,clickTemplate:g,getClickHtml:function(l){return d.Deferred(function(m){var p=l.getId(),o="#officeSummaryClickOverlay_"+p,n=d(o).html();m.resolve(n)}).promise()},getHoverHtml:function(l){return d.Deferred(function(m){var p=l.getId(),o="#officeSummaryHoverOverlay_"+p,n=d(o).html();m.resolve(n)}).promise()},hoverOffset:{x:1+480,y:-70+147,tip:6},clickOffset:{x:1+480,y:-45+147,tip:5}}),e=function(){};h.showClickTooltip=k.showClickTooltip;h.showHoverTooltip=k.showHoverTooltip;h.hideHoverTooltip=k.hideHoverTooltip;h.clear=k.clear;e()}});window.Century21.Setup.mapModule(function(d,b,a,c){a.PropertyPaginator=function(p){var k=p.find(".propPhotos"),l=k.find(".slideImgBtnLeft"),g=k.find(".slideImgBtnRight"),q=k.find("img"),t=k.find(".photoLink"),f=t.attr("href"),s=p.find(".allPhotos"),n=p.find(".totalImagesText"),o=s.find(".propImageURL"),r=[],j=0,i=false,m=new Image();m.src="/images/loading/snake-black-32x32.gif";function h(v){var u="Image "+(v+1).toString()+" of "+r.length.toString();n.text(u)}function e(w){if(i){return}var v=new Image(),u=r[w];q.src=m.src;i=true;v.onload=function(){j=w;q.attr("src",u);i=false;t.attr("href",f+"?g="+w);h(w)};v.src=u}o.each(function(u,w){var v=d(w),x=v.text();r.push(x)});e(0);l.click(function(){var u=(j+r.length-1)%r.length;e(u)});g.click(function(){var u=(j+1)%r.length;e(u)});if(r.length<=1){l.hide();g.hide()}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.SchoolTooltipManager=function(g){var p=this,o=g,j,m=d("<div class='schoolSummaryHoverOverlay'><div class='contentTip'></div></div>"),h=d("<div class='schoolSummaryClickOverlay'><div class='contentTip'></div></div>"),l=function(u,s){var r=s.getId(),q=u.html(),t=b.SchoolSearch.parseBoundary(r,q);j.addShape(r,t)},i=function(q,r){b.portalAjax.doViewEngineAjax("SchoolSummaryOverlay","/schoolsearch.c21",d.param({sid:q}),{callback:r})},f=function(q,r){return d.Deferred(function(s){var t=q.getId();i(t,function(){var v=d(r),u=v.html();s.resolve(u)})}).promise()},n=function(s,q){if(!s){return}var r=s.getId();j.setShapeVisibility(s,q);j.setPinHighlighted(r,q);d("#schoolRecord_"+r).toggleClass("hover",q)},e=new a.TooltipManager(o,{hoverTemplate:m,clickTemplate:h,getClickHtml:function(q){return f(q,"#schoolSummaryClickOverlay")},onShowClickTooltip:function(q){if(!q){return}j.setClickPin(q,true);l(d("#schoolSummaryClickOverlay"),q);n(q,true)},onHideClickTooltip:function(q){if(!q){return}j.setClickPin(q,false);n(q,false)},onShowHoverTooltip:function(q){if(!q){return}l(d("#schoolSummaryHoverOverlay"),q);n(q,true)},onHideHoverTooltip:function(q){if(!q){return}n(q,false)},getHoverHtml:function(q){return f(q,"#schoolSummaryHoverOverlay")},hoverOffset:{x:1+480,y:-73+147,tip:-4},clickOffset:{x:9+480,y:-73+147,tip:-4}}),k=function(){};p.showClickTooltip=e.showClickTooltip;p.showHoverTooltip=e.showHoverTooltip;p.hideHoverTooltip=e.hideHoverTooltip;p.hideTooltipByPinData=e.hideTooltipByPinData;p.clear=e.clear;p.setLayer=function(q){j=q};k()}});window.Century21.Setup.mapModule(function(d,b,a,c){a.ResultPropertyTooltipManager=function(k){var h=this,i=k,f=d("<div class='propertySummaryHoverOverlay'><div class='contentTip'></div></div>"),g=d("<div class='propertySummaryClickOverlay'><div class='contentTip'></div></div>"),j=function(n,m){a.PropertyPaginator(n)},l=new a.TooltipManager(i,{hoverTemplate:f,clickTemplate:g,initClickTooltip:j,getClickHtml:function(m){return d.Deferred(function(n){var o=m.getId(),p=d("#propertySummaryClickOverlay_"+o);g.find(".contentTip").empty();d(".propertySummaryClickOverlay").removeClass("favorite");b.ViewSession.setFavoriteProperty(d(".propertySummaryClickOverlay"),o);n.resolve(p.html())}).promise()},getHoverHtml:function(m){return d.Deferred(function(n){var o=m.getId(),p=d("#propertySummaryHoverOverlay_"+o);n.resolve(p.html())}).promise()},hoverOffset:{x:11+480,y:-47+147,tip:-4},clickOffset:{x:10+480,y:-21+147,tip:-4}}),e=function(){};h.showClickTooltip=l.showClickTooltip;h.showHoverTooltip=l.showHoverTooltip;h.hideHoverTooltip=l.hideHoverTooltip;h.clear=l.clear;e()}});window.Century21.Setup.mapModule(function(d,b,a,c){a.BackgroundPropertyTooltipManager=function(f){var m=this,k=f,j=d("<div class='propertySummaryHoverOverlay'><div class='contentTip'></div></div>"),g=d("<div class='propertySummaryClickOverlay'><div class='contentTip'></div></div>"),l=function(o,n){a.PropertyPaginator(o)},h=function(n,o){b.portalAjax.doViewEngineAjax("PropertySummaryOverlay","/propertysummary.c21",d.param({pid:n}),{callback:o})},e=new a.TooltipManager(k,{hoverTemplate:j,clickTemplate:g,initClickTooltip:l,getClickHtml:function(n){return d.Deferred(function(o){var p=n.getId();g.find(".contentTip").empty();h(p,function(){var r=d("#propertySummaryClickOverlay"),q=r.html();o.resolve(q)})}).promise()},getHoverHtml:function(n){return d.Deferred(function(o){var p=n.getId();h(p,function(){var r=d("#propertySummaryHoverOverlay"),q=r.html();o.resolve(q)})}).promise()},hoverOffset:{x:2+480,y:-38+147,tip:-4},clickOffset:{x:10+480,y:-21+147,tip:-4}}),i=function(){};m.showClickTooltip=e.showClickTooltip;m.showHoverTooltip=e.showHoverTooltip;m.hideHoverTooltip=e.hideHoverTooltip;m.clear=e.clear;i()}});window.Century21.Setup.mapModule(function(d,b,a,c){a.MyPlaceTooltipManager=function(i){var g=this,h=i,f=d("<div class='myPlaceMapHoverOverlay'><div class='contentTip'></div></div>"),j=new a.TooltipManager(h,{hoverTemplate:f,getHoverHtml:function(k){return d.Deferred(function(l){var m=d("#myPlaceMapHoverOverlay");l.resolve(m.html())}).promise()},hoverOffset:{x:1+480,y:-45+147,tip:4},clickOffset:{x:10+480,y:-21+147,tip:-4}}),e=function(){};g.showHoverTooltip=function(k){f.attr("class","myPlaceMapHoverOverlay pinHover"+k.getData("colorIndex"));return j.showHoverTooltip(k)};g.hideHoverTooltip=j.hideHoverTooltip;g.clear=j.clear;e()}});window.Century21.Setup.mapModule(function(d,b,a,c){a.SurroundingAreaTooltipManager=function(i){var g=this,h=i,j,f=d("<div class='surroundingAreaMapHoverOverlay'><div class='contentTip'></div></div>"),j=new a.TooltipManager(h,{hoverTemplate:f,getHoverHtml:function(k){return d.Deferred(function(l){var m=k.getId(),n=d("#surroundingAreaMapHoverOverlay");l.resolve(n.html())}).promise()},hoverOffset:{x:1+480,y:-45+147,tip:4},clickOffset:{x:10+480,y:-21+147,tip:-4}}),e=function(){};this.showHoverTooltip=function(k){f.attr("class","surroundingAreaMapHoverOverlay pinHover"+k.getData("colorIndex"));return j.showHoverTooltip(k)};this.hideHoverTooltip=j.hideHoverTooltip;this.clear=j.clear;e()}});window.Century21.Setup.mapModule(function(d,b,a,c){a.MapTypeOverlay=function(e){var l=(this.constructor==a.MapTypeOverlay)?this:{},k=e,h=d("#bingMapTypeRoad"),m=d("#bingMapTypeAutomatic"),j=d("#bingMapTypeBE"),g=d("#bingMapTypeAerial"),i=function(n){n.preventDefault();n.data()},f=function(){var n=k.getMapTypeId();switch(n){case c.MapTypeId.road:l.setRoad();break;case c.MapTypeId.birdseye:l.setBirdsEye();break;case c.MapTypeId.Aerial:l.setAerial();break;default:l.setAutomatic();break}h.on("click",l.setRoad,i);m.on("click",l.clickAutomatic,i);j.on("click",l.setBirdsEye,i);g.on("click",l.setAerial,i)};l.setAutomatic=function(){k.setMapType(c.MapTypeId.auto);h.removeClass("selected").addClass("notSelected");m.addClass("selected").removeClass("notSelected");j.removeClass("selected").addClass("notSelected");g.removeClass("selected").addClass("notSelected")};l.clickAutomatic=function(){b.Track.doEvent("Hybrid Mapping","Tool Bar","Select Automatic Map View");l.setAutomatic()};l.setRoad=function(){b.Track.doEvent("Hybrid Mapping","Tool Bar","Select Road Map View");k.setMapType(c.MapTypeId.road);m.removeClass("selected").addClass("notSelected");h.addClass("selected").removeClass("notSelected");j.removeClass("selected").addClass("notSelected");g.removeClass("selected").addClass("notSelected")};l.setBirdsEye=function(){b.Track.doEvent("Hybrid Mapping","Tool Bar","Select Birds Eye Map View");k.setMapType(c.MapTypeId.birdseye);m.removeClass("selected").addClass("notSelected");h.removeClass("selected").addClass("notSelected");j.addClass("selected").removeClass("notSelected");g.removeClass("selected").addClass("notSelected")};l.setAerial=function(){b.Track.doEvent("Hybrid Mapping","Tool Bar","Select Aerial Map View");k.setMapType(c.MapTypeId.aerial);m.removeClass("selected").addClass("notSelected");h.removeClass("selected").addClass("notSelected");j.removeClass("selected").addClass("notSelected");g.addClass("selected").removeClass("notSelected")};f()}});window.Century21.Setup.mapModule(function(d,b,a,c){a.Paginator=function(i,f){var h=d("#pageSelector"),g=function(j,n){var o=h.get(0),l;h.empty();if(o.length==0){for(l=1;l<=j;l++){var m=document.createElement("option");m.text=l;m.value=l;if(n==l){m.selected=true}try{o.add(m,null)}catch(k){o.add(m)}}}},e=function(){g(i,f);h.change(function(){var k=h.val();if(d("body").hasClass("liquidLayout")){var j=d("#lqSearchType").val();if(j=="PROPERTIES"){Track.doEvent("Hybrid Mapping","Property Center Lane","Select Results Page",parseInt(k))}else{if(j=="AGENTS"){Track.doEvent("Hybrid Mapping","Agent Center Lane","Select Results Page",parseInt(k))}else{if(j=="OFFICES"){Track.doEvent("Hybrid Mapping","Office Center Lane","Select Results Page",parseInt(k))}}}}return b.portalResults.setPage(k,false)})};e()}});window.Century21.Setup.mapModule(function(d,b,a,c){a.AreaOverlayUi=function(){var g=this,h,i,f=d(".areaOverlay"),e=function(){f.click(function(){var j=d(this),k=j.hasClass("selected");if(k){j.removeClass("selected");i=j.attr("metaType");b.Track.doEvent("Hybrid Mapping","Heat Map Overlay Tool","Deselect "+i);i=null}else{f.removeClass("selected");j.addClass("selected");i=j.attr("metaType");b.Track.doEvent("Hybrid Mapping","Heat Map Overlay Tool","Select "+i)}if(h){h()}})};e();g.setClickEvent=function(j){h=j};g.getAreaOverlaySelection=function(){return i}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.PaginatorButtons=function(){var f=this,h=d(".mapToolsArea .prevBtn"),g=d(".mapToolsArea .nextBtn"),i=0,e=function(){g.click(function(){if(g.hasClass("disabled")){return}b.Track.doEvent("Hybrid Mapping","Tool Bar","Select next button map paginator");b.portalResults.setPage(i+1,false)});h.click(function(){if(h.hasClass("disabled")){return}b.Track.doEvent("Hybrid Mapping","Tool Bar","Select previous button map paginator");b.portalResults.setPage(i-1,false)})};e();f.updatePaginatorButtons=function(){var l=d("#currentpage"),k=d("#maxpage"),j=parseInt(k.val(),10);i=parseInt(l.val(),10);if(i==j){g.addClass("disabled")}else{g.removeClass("disabled")}if(i==1){h.addClass("disabled")}else{h.removeClass("disabled")}}}});window.Century21.Setup.mapModule(function(d,b,a,c){a.Page=function(){var v=this,q,I,i=[],o=false,K=false,l=function(){var L=d("#LiquidBodySubsection").width(),M=d("#BodyCenterLane.fullList");M.find("#PropertyRowContainer > .propertyRow").width(L-36);M.width(L)},z=function(){var R=d("#PropertyRowContainer"),L=R.height(),P=0,S=L,O=R.children(".propertyRow"),M=d("#extendedListCountsTitle"),Q=M.is(":visible"),N=d();O.each(function(Y,W){var ab=d(W),V=ab.height(),Z=ab.position(),X=Z.top,T=X+V,ac=(T<S)&&(T>P),U=(X<S)&&(X>P);if(ac||U){N=N.add(ab.find("img.fullListMain"));if(Q){var aa=ab.find(".photoFlow");aa.each(function(){var af=d(this),ag=af.find("img");if(ag.data("preloaded")==true){return}var ae=af.parents(".propertyRow").find(".CardThumb img"),ad=ae.attr("rel");ag.hover(function(){ae.attr("src",d(this).attr("src"))},function(){ae.attr("src",ad)});if(af.parent().position().top-X<10){ag.data("preloaded",true);N=N.add(ag)}})}}});if(N.length>0){b.ImageLazyLoader.loadImages(N)}},u=function(){if(d("#listContainer").hasClass("propertyList")&&d("#BodyCenterLane").hasClass("fullList")){var L=d("#PropertyRowContainer"),M=L.children(".propertyRow");M.each(function(P,N){var O=d(N),U="#"+O.attr("id"),R=d(U+"propertyDescCollapse"),S=d(U+"propertyFeatures"),V=d(U+"propertyDetailPhotos"),W=V.children(".photoFlow"),Q=W.children(".landscapeThumbContainer");if(R.length>0){if(!R.hasClass("collapsed")){var T=R.attr("expandLink");R.addClass("collapsed");b.Collapsasaurus(R,7,{expandText:"&hellip;Read More",expandURL:T,expandCallback:function(){Track.doEvent("Hybrid Mapping","Property List View","Read More Description")}})}}S.columns({width:200,height:110});Q.hover(function(){d(this).addClass("hover")},function(){d(this).removeClass("hover")});W.last().addClass("last")})}},F=function(){if(d("#listContainer").hasClass("officeList")&&d("#BodyCenterLane").hasClass("fullList")){d(".officeProfile .paragraphsCollapse").each(function(){if(!d(this).hasClass("collapsed")){var L=d(this).find(".officeLink").val();d(this).addClass("collapsed");b.Collapsasaurus(d(this),5,{expandText:"&hellip;Read More",expandURL:L})}})}},J=function(){if(d("#listContainer").hasClass("agentList")&&d("#BodyCenterLane").hasClass("fullList")){d(".agentProfile .paragraphsCollapse").each(function(){if(!d(this).hasClass("collapsed")){var L=d(this).find(".agentLink").val();d(this).addClass("collapsed");b.Collapsasaurus(d(this),5,{expandText:"&hellip;Read More",expandURL:L})}})}},G=function(){K=true;var Q=d("#BodyCenterLane"),P=d("#LiquidBodyMain"),O=d("#listContainer"),N=Q.width(),S=P.width(),R=function(){if(O.hasClass("propertyList")){u()}else{if(O.hasClass("officeList")){F()}else{if(O.hasClass("agentList")){J()}}}};if(d.browser.msie&&d.browser.version<9){setTimeout(function(){Q.css({width:S+N});R()},400)}else{Q.animate({width:S+N},{duration:400,easing:"easeOutQuad",complete:R})}Q.addClass("fullList");P.css({"z-index":-1});d("#extendedListCountsTitle").show();d("#FullListViewTopPagination").show();b.Track.doEvent("Hybrid Mapping","Collapse/Expand","Show List View");b.portalAjax.setCookie("LAST_LIST_VIEW","Open");z();var L=d("#PropertyRowContainer"),M=L.children(".propertyRow");M.each(function(U,W){var X=d(W),Y="#"+X.attr("id"),V=d(Y+"propertyDetailPhotos"),Z=V.children(".photoFlow"),T=Z.children().length;if(T.length==0){d(Y+"propertyDescription").addClass("noImages")}});if(d.browser.msie&&d.browser.version<9){P.css({opacity:0})}else{P.animate({opacity:0},{duration:400,easing:"easeOutQuad",complete:function(){}})}l()},t=function(L,O){K=false;var N=d("#BodyCenterLane"),M=d("#LiquidBodyMain");d("#extendedListCountsTitle").hide();d("#FullListViewTopPagination").hide();b.Track.doEvent("Hybrid Mapping","Collapse/Expand","Hide List View");b.portalAjax.setCookie("LAST_LIST_VIEW","Closed");if(d.browser.msie&&d.browser.version<9){N.css({width:349});M.css({opacity:1})}else{N.animate({width:349},{duration:400,easing:"easeOutQuad"});M.animate({opacity:1},{duration:400,easing:"easeOutQuad"})}N.removeClass("fullList");d.when(N.promise(),M.promise()).then(function(){M.css({"z-index":""});if(!O){q.fixAfterShow()}l();if(L){L()}})},B=function(){var O=d("#panelToggleControl"),L=d("#fullListToggleControl"),Q=d("#BodyCenterLane"),M=d("#LiquidBodyMain"),T=d("#listContainer"),S=Q.width(),R=M.width(),P=M.position(),U=this;var N=b.portalAjax.getCookie("LAST_LIST_VIEW");if(N=="Open"){G()}T.on("click","#fullListHideToggleControl",function(){t()});L.click(function(){G()});U.open=function(){if(!O.hasClass("opened")){return}if(!q.isSurroundingAreaViewSelected()){b.Track.doEvent("Hybrid Mapping","Collapse/Expand","Show Map View")}M.animate({width:R+S,left:P.left-S},{duration:400,easing:"easeOutQuad"});O.removeClass("opened").addClass("closed");L.hide();l()};U.close=function(){if(O.hasClass("opened")){return}if(!q.isSurroundingAreaViewSelected()){b.Track.doEvent("Hybrid Mapping","Collapse/Expand","Hide Map View")}M.animate({width:R,left:P.left},{duration:400,easing:"easeOutQuad"});O.removeClass("closed").addClass("opened");L.show();l()};O.click(function(){if(O.hasClass("opened")){U.open()}else{U.close()}})},E=function(){o=true;d.each(i,function(L,M){M()})},H=function(){var L=d("#searchWithinMap"),M=d("#searchWithinMapEnabled").val();if(M==="true"){L.attr("checked",true)}else{L.attr("checked",false)}if(d("#drawTool").hasClass("selected")){L.attr("checked",false);L.attr("disabled","disabled")}L.click(function(){var O=d(this).attr("checked");if(O){b.Track.doEvent("Hybrid Mapping","Search Within Map","Select");q.lockAutoZoomToPins();var N=d("#selectedSchoolIds").val();if(N!=null&&N!=""){b.SchoolSearch.showSchoolDeletionModal();return}b.SchoolSearch.clearSchoolSearchCriteria();b.SchoolSearch.closeWindow();b.portalResults.changeLiquidMapSearchWithinMapFacet()}else{b.Track.doEvent("Hybrid Mapping","Search Within Map","Deselect");q.unlockAutoZoomToPins();q.refreshLocationBoundaryMap();b.portalResults.removeLiquidMapSearchWithinMapFacet()}})},y=function(){c.loadModule("Microsoft.Maps.Overlays.Style",{callback:function(){var Q=d("#bingMap");var X=new b.PortalParams(),N=X.get("px"),O,L,Z,P,Y=false;if(N==""||N==null){Y=true}else{var V=N.split(","),T=parseFloat(V[1],10),W=parseFloat(V[0],10),S=parseFloat(V[3],10),U=parseFloat(V[2],10);if(isNaN(T)||isNaN(W)||isNaN(S)||isNaN(U)){Y=true}else{O=new c.LocationRect.fromCorners(new c.Location(T,W),new c.Location(S,U));P=true}}if(Y){var M=d("#searchLocationLatitude").val(),R=d("#searchLocationLongitude").val();L=new c.Location(M,R);Z=8;P=false}q=new a.Map(Q,{bounds:O,center:L,zoom:Z,lockAutoZoomToPins:P});E();b.portalAjax.bindLoadEvent(d("#BodyRightLane"),function(){H()})}})},x=function(){d("#refineLanguageFeaturesButton").click(function(){var L=d("#lqSearchType").val();if(L=="AGENTS"){b.Track.doEvent("Hybrid Mapping","Left Lane","View Agent Language Options")}else{if(L=="OFFICES"){b.Track.doEvent("Hybrid Mapping","Left Lane","View Office Language Options")}}b.portalResults.loadLanguageSearchOptions()})},n=function(){d("#listContainer").removeClass("propertyList").addClass("agentList").removeClass("officeList");x();J()},h=function(){d("#listContainer").removeClass("propertyList").removeClass("agentList").addClass("officeList");x();F()},w=function(){d("#listContainer").addClass("propertyList").removeClass("agentList").removeClass("officeList");u();var L=false;function M(){L=true}function N(){if(!L){return}setTimeout(function(){var O=false,P=d("#lqbedrooms, #lqbathrooms, #lqstructureSize, #lqprice");d.each(P,function(Q,R){var S=d(R);if(!S.c21dropdown("hidden")){O=true;return false}});if(O){return}b.portalResults.updateLiquidFacets()},1000)}d("#lqbedrooms").c21dropdown({maxLength:2,tabIndex:402,onBlurAndChange:M,onBlur:N,dropdownClass:"lqdropdownCustomizations",selectBoxClass:"lqselectorCustomizations",baseName:"lqbedrooms"});d("#lqbathrooms").c21dropdown({maxLength:2,tabIndex:404,onBlurAndChange:M,onBlur:N,dropdownClass:"lqdropdownCustomizations",selectBoxClass:"lqselectorCustomizations",baseName:"lqbathrooms"});d("#lqstructureSize").c21dropdown({maxLength:7,tabIndex:406,onBlurAndChange:M,onBlur:N,dropdownClass:"lqdropdownCustomizations",selectBoxClass:"selectorSquareFeet",baseName:"lqstructureSize"});d("#lqprice").c21dropdown({maxLength:7,tabIndex:400,onBlurAndChange:M,onBlur:N,dropdownClass:"lqdropdownCustomizations",selectBoxClass:"selectorPrice",baseName:"lqprice"});d("#lqbedrooms").c21dropdown("setValue",d("#lqMinBedHidden").val(),d("#lqMaxBedHidden").val());d("#lqbathrooms").c21dropdown("setValue",d("#lqMinBathHidden").val(),d("#lqMaxBathHidden").val());d("#lqstructureSize").c21dropdown("setValue",d("#lqMinSqftHidden").val(),d("#lqMaxSqftHidden").val());d("#lqprice").c21dropdown("setValue",d("#lqMinPriceHidden").val(),d("#lqMaxPriceHidden").val());d("#refineFeaturesButton").click(function(){b.Track.doEvent("Hybrid Mapping","Left Lane","View More Property Search Options");b.portalResults.loadMoreSearchOptions()})},f=function(){var L=d("#seoFooterPanel");L.click(function(){if(L.hasClass("opened")){L.removeClass("opened").addClass("closed");d("#PageFooter").hide()}else{L.removeClass("closed").addClass("opened");d("#PageFooter").show()}});d(".expandoFooterContainer").each(function(Q,R){var M=d(R),P=M.find("a"),O=M.parent().find("div");if(O!=null&&O.length>0){O.splice(-1,1)}if(O.length>5){var N=O.slice(-1*(O.length-5)),S=true;N.hide().find("a").css({color:"#f3f3f3"});M.show();P.click(function(T){T.preventDefault();S=!S;if(S){P.text("Show More");N.find("a").animate({color:"#f3f3f3"},300);setTimeout(function(){N.slideUp()},300)}else{P.text("Hide");N.slideDown(300);setTimeout(function(){N.find("a").animate({color:"#898989"},300,function(){d(this).css({color:""})})},300)}})}})},s=function(){d("#listContainer").animate({scrollTop:0},1000,"easeOutQuart");f();I.updatePaginatorButtons();if(d("#BodyCenterLane").hasClass("fullList")){d("#extendedListCountsTitle").show();d("#FullListViewTopPagination").show()}else{d("#FullListViewTopPagination").hide()}z();u();F();J();var L=d("#lqSearchType").val();if(L==="AGENTS"){r()}},k=function(){b.SurroundingAreasMapping.initialize()},A=function(){b.SchoolSearch.initialize()},m=function(){var O=false,P=300,L=d(".mapToolsArea .panelToggleButton"),M=d(".mapToolsArea"),N=d("#bottomMapToolsDropDown"),Q=function(R){d("#bottomMapToolsDropDown").hide();R.show()};L.click(function(){if(O){return}d("#myPlacesToolInstructions").removeClass("active");var S=d(this),T=S.hasClass("selected"),R=S.attr("href"),U=d(R);O=true;L.removeClass("selected");if(T){b.Track.doEvent("Hybrid Mapping","Tool Bar","Collapse");N.slideUp(P,function(){O=false});M.animate({bottom:0},P)}else{b.Track.doEvent("Hybrid Mapping","Tool Bar","Expand");L.removeClass("selected");S.addClass("selected");N.slideDown(P,function(){Q(U);O=false});M.animate({bottom:160},P)}if(!d("#bottomMapTools").hasClass("selected")){d(".overlayToolTip").hide();d(".overlayToolTip").removeClass("shown")}})},D=function(P){var R=P.split(","),M=[],L,S,Q,N,O=false;for(N=0;N<R.length;N=N+2){S=parseFloat(R[N+1],10);Q=parseFloat(R[N],10);if(isNaN(S)||isNaN(Q)){return false}L=new c.Location(S,Q);M.push(L)}L=new c.Location(R[1],R[0]);M.push(L);return M},p=function(){var M=new b.PortalParams(),N=M.get("dt");if(N!=null){var L=D(N);if(L===false){return}q.addLassoPoly(L)}},j=function(){var U=d("#currentSearch"),Q=d(".currentSrBox"),N=Q.find(".LaneTitle"),O=U.find(".LaneText"),T=d(".currentSearchSlider"),M=100,R=10,L=O.height()+(R*2),P=L>M,W=N.height(),S=M+W,V=L+W;T.toggle(P);Q.off(".initRefinement").css("height","");if(!P){return}Q.css({height:S});Q.on({"mouseenter.initRefinement":function(){Q.stop(true).animate({height:V});U.css({maxHeight:99999});b.SchoolSearch.expandBannerPosition(parseInt(V,10)-122);b.SchoolSearch.expandTooltipPosition(parseInt(V,10)-122);b.SurroundingAreasMapping.expandTooltipPosition(parseInt(V,10)-122)},"mouseleave.initRefinement":function(){Q.stop(true).animate({height:S});b.SchoolSearch.collapseBannerPosition(parseInt(S,10)-90);b.SchoolSearch.collapseTooltipPosition(parseInt(S,10)-90);b.SurroundingAreasMapping.collapseTooltipPosition(parseInt(S,10)-90)}})},r=function(){d(".CenterLaneCardBg.CardWrapper").each(function(L,M){var O=d(this),N=O.parent();N.hover(function(){O.addClass("hover")},function(){O.removeClass("hover")})});if(q){q.refreshLocationBoundaryMap()}},C,e=function(){d("#areaOverlayAge, #areaOverlayPrice, #areaOverlayIncome").hover(function(){d(this).addClass("hover")},function(){d(this).removeClass("hover")});d("#pointsOfInterestDiv").find(".pointOfInterestCheckbox").uniform();I=new a.PaginatorButtons();C=new B();y();m();I.updatePaginatorButtons();var R=d("#mapToolTip"),L=d("#mapToolTipText"),P=d("#drawingToolInstructions"),O=d("#myPlacesToolInstructions"),N=d("#bottomMapToolsDropDown"),Q=d("#bottomMapTools");Q.click(function(){P.removeClass("active");O.removeClass("active")});d("#myPlacesTool").hover(function(){P.removeClass("active");if(!d(this).hasClass("selected")){L.text("MY PLACES");R.show().css({bottom:56+(N.is(":visible")?160:0),left:-93,width:94})}else{O.addClass("active").css("bottom",56+(d("#bottomMapToolsDropDown").is(":visible")?160:0))}},function(){R.hide()});d("#drawTool").hover(function(){if(!P.hasClass("active")){O.removeClass("active");L.text("DRAWING TOOL");R.show().css({bottom:56+(N.is(":visible")?160:0),left:-66,width:94})}},function(){R.hide()});d("#prevBtn").hover(function(){P.removeClass("active");O.removeClass("active");L.text("PREVIOUS PAGE");R.show().css({bottom:56+(N.is(":visible")?160:0),left:-43,width:100})},function(){R.hide()});d("#nextBtn").hover(function(){P.removeClass("active");O.removeClass("active");L.text("NEXT PAGE");R.show().css({bottom:56+(N.is(":visible")?160:0),left:-8,width:76})},function(){R.hide()});var M=d("#refineSearch");b.portalAjax.bindLoadEvent(M,function(){j();A();k();setTimeout(function(){var S=d("#lqSearchType").val();if(S==="PROPERTIES"){w()}else{if(S==="AGENTS"){n()}else{if(S==="OFFICES"){h()}}}r()},10)});b.portalAjax.bindLoadEvent(d("#BodyCenterLane, #listContainer"),s);d(window).resize(z);d("#listContainer").scroll(z);d(document.body).click(function(){q.unlockAutoZoomToPins()})},g=function(){d(document).ready(e);d(window).resize(l);v.onReady(p)};v.closeCenterLane=function(L,M){if(K){t(function(){C.open();if(L){L()}},M)}else{C.open();if(L){L()}}};v.openCenterLane=function(){C.close()};v.getMap=function(){return q};v.onReady=function(L){if(o){L()}else{i.push(L)}};g()}});