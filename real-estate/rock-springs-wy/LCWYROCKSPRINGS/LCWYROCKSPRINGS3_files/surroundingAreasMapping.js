




/*
     FILE ARCHIVED ON 10:23:49 Mar 16, 2015 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 16:20:57 Aug 11, 2016.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
window.surroundingAreasMapping=new function(){var s=this,t=window.internationalization,j="",u="",q={},e={},n={},y={City:0,Neighborhood:1,Zipcode:2},a={TYPE_CITY:0,TYPE_NEIGHBORHOOD:1,TYPE_ZIPCODE:2},z={},i="",c=200,x=[],v=function(){var J=$("#selectedCities").val(),L=$("#selectedNeighborhoods").val(),I=$("#selectedZipcodes").val(),K="",H;K=B(K,J);K=B(K,L);K=B(K,I);if(K==""){H=[]}else{H=K.split(",")}x=H;$.each(x,function(M,O){var N=e[O];d(N.lid)})},r=function(){var H=$("#surroundingAreaSearchType").val()||"City";return H},G=function(H){return $("#surroundingArea_"+H)},m=function(H){return H.parent().parent().parent()},h=function(H){return m(G(H))},k=function(H){return H.parents(".searchType")},b=function(H){$("#panelToggleControl, #fullListToggleControl").toggle(H)},D=function(){s.updateCurrentAreaSelections();$("#SurroundingAreasModalDiv").show();b(false);var N=$("#surroundingAreasToolTip"),I=N.find("input:radio"),P=N.find("input:checkbox"),M=$();I.uniform();P.uniform();N.show();$.uniform.update();I.each(function(){var R=$(this),Q=k(R);Q.toggleClass("selected",R.attr("checked"));M.add(Q);R.click(function(){if(!R.attr("checked")){return}M.removeClass("selected");Q.addClass("selected");$("#surroundingAreaSearchType").val(R.val());$("#switchAreaSearchType").val("Y");Track.doEvent("Surrounding Areas","Select Search Type",R.val());s.loadSurroundingAreasModal()})});var H=window.g_pageLiquidLayout.getMap();P.click(function(){var R=$(this),T=R.attr("checked"),Q=R.val(),S=m(R).find(".checkLabel").html();if(T){s.gaTrackAddArea(S);d(Q)}else{s.gaTrackRemoveArea(S);g(Q)}R.parent().parent().parent().toggleClass("selected",T);H.setSurroundingAreaChecked(Q,T)});$(".surroundingCheckLabel").hover(function(){var R=$(this);if(R.hasClass("selected")){return}R.addClass("hover");var Q=R.find("input:checkbox").val();H.setSurroundingAreaHover(Q,true)},function(){var R=$(this);R.removeClass("hover");var Q=R.find("input:checkbox").val();H.setSurroundingAreaHover(Q,false)});E();p();H.renderSurroundingAreas();var K=$("#surroundingAreasLiqMap"),L=$("#surroundingAreasToolTip"),O=K.position(),J=L.find(".contentTip");J.css("top",c);L.css({top:O.top-J.position().top})},E=function(){var I=$("#myPlacesSection"),H=window.g_pageLiquidLayout.getMap();I.hover(function(){I.addClass("hover")},function(){I.removeClass("hover")});I.find(".myplaceLink, .myplaceIcon").click(function(){if(I.hasClass("selected")){Track.doEvent("Surrounding Areas","Turn off My Places");l();H.disableMyC21Places()}else{Track.doEvent("Surrounding Areas","Turn on My Places");F();H.enableMyC21Places();$("#myPlacesToolInstructions").removeClass("active")}});if(H.isMyPlacesEnabled()){F()}else{l()}if(window.databaseAvailable&&(window.sessionAvailable||(!window.sessionAvailable&&window.sessionAuthenticated))){I.show()}else{I.hide()}},A=function(){if((g_MyPlaces==null)||(g_MyPlaces!=null&&g_MyPlaces.length==0)){C21.Places.loadMyPlacesModal()}},F=function(){var I=$("#myPlacesSection");var H=$(".myplaceLink");H.text(t.getString("Turn off My Places"));I.addClass("selected")},l=function(){var I=$("#myPlacesSection");var H=$(".myplaceLink");H.text(t.getString("Turn on My Places"));I.removeClass("selected")},p=function(){var K=$("#surroundingAreasToolTip"),I=K.find("input:checkbox"),H=s.getSelectionsBox(),J=H.val();I.each(function(){var M=$(this),L=M.parent().parent().parent();if(J&&C(J.split(","),M.val())){L.addClass("selected");M.attr("checked",true)}else{L.removeClass("selected");M.attr("checked",false)}});$.uniform.update()},f=function(I,H){var J=I.val();if(J){if(J.indexOf(H+",")!=-1){J=J.replace(H+",","")}else{if(J.indexOf(","+H)!=-1){J=J.replace(","+H,"")}else{J=J.replace(H,"")}}}I.val(J)},C=function(H,J){var I=H.length;while(I--){if(H[I]===J){return true}}return false},o=function(I){$("#SurroundingAreasModalDiv").hide();b(true);var H=s.getSelectedSurroundingAreas();portalResults.changeSurroundingAreas(0,H,I);if(H.length!=0){Track.doEvent("Surrounding Areas","Added areas to search",H.length)}},B=function(H,I){if(H==""){H=I}else{if(I!=""){H=H+","+I}}return H},d=function(I){if(n[I]){return}var K=e[I],H=s.getSelectionsBox(I),J=H.val();q[K.location]=K;n[I]=K;if(J==null||J==""){J=I}else{J=J+","+I}H.val(J)},g=function(I){if(!n[I]){return}var K=e[I],H=s.getSelectionsBox(I),J=H.val();delete q[K.location];delete n[I];if(J){if(J.indexOf(I+",")!=-1){J=J.replace(I+",","")}else{if(J.indexOf(","+I)!=-1){J=J.replace(","+I,"")}else{J=J.replace(I,"")}}}H.val(J)},w=function(){var O=$("#fullListToggleControl"),M=$(".LiquidBodyMiddle"),L=$(".LiquidBodyMain"),K=$("#listContainer"),I=M.width(),N=L.width(),H=L.position(),J=$("#surroundingAreasLiqMap");J.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});J.click(function(){if(J.hasClass("selected")){Track.doEvent("Surrounding Areas","Close Surrounding Areas Tool");$(".mapToolsArea").show();$("#typeContainer").show();$(".OverlaysTL").show();$("#BodyRightLane").show();$("#mapContainer").css("top","31px");if($("#bottomMapTools").hasClass("selected")){$("#bottomMapToolsDropDown").show()}var P=s.getSelectedSurroundingAreas().join(),S=x.join(),Q=true;if(P==S&&j!=""&&u!=""){window.g_pageLiquidLayout.getMap().setMapView(j,u);Q=false}$("#searchLocationLIDS").val(P);var R=window.g_pageLiquidLayout.getMap();R.clearSurroundingAreas();R.refreshHeatmap();R.refreshPOI();window.g_pageLiquidLayout.openCenterLane();J.removeClass("selected");o(Q)}else{window.g_pageLiquidLayout.onReady(function(){j=window.g_pageLiquidLayout.getMap().getZoom();u=window.g_pageLiquidLayout.getMap().getBounds();Track.doEvent("Surrounding Areas","Open Surrounding Areas Tool");J.addClass("selected");$(".mapToolsArea").hide();$("#typeContainer").hide();$(".OverlaysTL").hide();$("#BodyRightLane").hide();$("#mapContainer").css("top","0px");$("#bottomMapToolsDropDown").hide();var T=window.g_pageLiquidLayout.getMap();T.clearAll();T.clearTooltips();T.clearHeatMap();T.clearPOI();T.clearSchools();$("#myPlacesToolInstructions").removeClass("active");$("#myPlacesTool").removeClass("selected");schoolSearch.closeWindow();$("#switchAreaSearchType").val("");window.g_pageLiquidLayout.closeCenterLane(function(){s.loadSurroundingAreasModal()},true)})}})};this.initialize=function(){w()};this.clearSurroundingAreas=function(){q={};n={};$("#selectedCities").val("");$("#selectedNeighborhoods").val("");$("#selectedZipcodes").val("")};this.updateTooltipPosition=function(H){var J=c+H,K=$("#searchListSection");if(K.length===0){return}var N=K.position().top,I=N+K.height(),M=$("#surroundingAreasToolTip .contentTip"),L=M.height();M.stop().animate({top:J},{step:function(O){if(O>(I-L)){M.hide();return}if(O<N){M.hide();return}M.show()}})};this.addData=function(H){z=H.locations;$.extend(z,q);e={};$.each(z,function(I,J){e[J.lid]=J})};this.addPrimaryData=function(H){$.each(H.locations,function(I,J){i=I;s.updateArea(I,J)})};this.updateArea=function(H,I){if(z[H]){$.extend(z[H],I)}else{z[H]=I}};this.addSearchCountsData=function(H){$.each(H.locations,function(I,J){s.updateArea(I,J)})};this.getSurroundingAreas=function(){return z};this.getPrimaryArea=function(){return z[i]};this.getPrimaryAreaLocation=function(){return i};this.getSurroundingArea=function(H){return z[H]};this.closeWindow=function(){if($("#surroundingAreasLiqMap").hasClass("selected")){$("#surroundingAreasLiqMap").trigger("click")}};this.isAreaSelected=function(H){return(n[H]!==undefined)};this.toggleSelectedSurroundingArea=function(J){var I=G(J),K=m(I),M=s.isAreaSelected(J),L=e[J],H=L.dislayName;if(M){s.gaTrackRemoveArea(H);g(J);M=false}else{s.gaTrackAddArea(H);d(J);M=true}if(I.length>0){I.attr("checked",M);K.toggleClass("selected",M);$.uniform.update()}return M};this.addHoverSurroundingAreaCheckbox=function(H){h(H).addClass("hover");$("#uniform-surroundingArea_"+H).addClass("hover");$.uniform.update()};this.removeHoverSurroundingAreaCheckbox=function(H){h(H).removeClass("hover");$("#uniform-surroundingArea_"+H).removeClass("hover");$.uniform.update()};this.gaTrackAddArea=function(J){var I=r(),H=$("#refineText").val();if(H!=null&&H!=""&&J!=null&&J!=""){Track.doEvent("Surrounding Areas","Add "+I,H+" added "+J)}};this.gaTrackRemoveArea=function(J){var I=r(),H=$("#refineText").val();if(H!=null&&H!=""&&J!=null&&J!=""){Track.doEvent("Surrounding Areas","Remove "+I,H+" removed "+J)}};this.getSelectedSurroundingAreas=function(){var H=[];$.each(n,function(I,J){H.push(I)});return H};this.loadSurroundingAreasModal=function(){var L=portalAjax.getParameters(),K=r(),M=$("#selectedCities").val()||"",J=$("#selectedNeighborhoods").val()||"",I=$("#selectedZipcodes").val()||"",H=$("#switchAreaSearchType").val()||"";$("#searchListCheckBoxes").addClass("loadingAreas").empty();portalAjax.doViewEngineAjax("flyout","/surroundingAreas.c21",$.param({lid:L.lid,zoom:18,surroundingsearchtype:K,selectedCities:M,selectedNeighborhoods:J,selectedZipcodes:I,switchAreaSearchType:H,submitted:true,v:3}),{cache:true,callback:function(){D();$("#searchListCheckBoxes").removeClass("loadingAreas");v()}})};this.removeAreaFromAllSearchTypes=function(H){if(H!=null&&H!=""){var I=n[H];delete q[I.location];delete n[H];f($("#selectedCities"),H);f($("#selectedNeighborhoods"),H);f($("#selectedZipcodes"),H)}};this.getCurrentSearchLidType=function(){var H=r();return y[H]};this.getSelectionsBox=function(H){var I=(H)?s.getLidType(H):s.getCurrentSearchLidType();switch(I){case a.TYPE_CITY:return $("#selectedCities");break;case a.TYPE_NEIGHBORHOOD:return $("#selectedNeighborhoods");break;case a.TYPE_ZIPCODE:return $("#selectedZipcodes");break;default:return null}};this.getLidType=function(I){var H=I.substring(0,1);switch(H){case"C":return a.TYPE_CITY;break;case"Z":return a.TYPE_ZIPCODE;break;case"P":case"Q":case"R":return a.TYPE_NEIGHBORHOOD;break;default:return null}};this.updateCurrentAreaSelections=function(){if($("#switchAreaSearchType").val()=="Y"){return}var J=portalAjax.getParameters(),H=J.sa;s.clearSurroundingAreas();if(H==null||H==""||H=="undefined"){return}else{var I=H.split(",");$.each(I,function(K,L){if(L!=null&&L!=""){d(L)}})}}};